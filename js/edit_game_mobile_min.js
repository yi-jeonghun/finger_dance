const DRUMS=[{name:"Bass Drum 2",file:"12835_0_Chaos_sf2_file.js",var:"_drum_35_0_Chaos_sf2_file",pitch:35},{name:"Bass Drum 1",file:"12836_0_Chaos_sf2_file.js",var:"_drum_36_0_Chaos_sf2_file",pitch:36},{name:"Side Stick/Rimshot",file:"12837_0_Chaos_sf2_file.js",var:"_drum_37_0_Chaos_sf2_file",pitch:37},{name:"Snare Drum 1",file:"12838_0_Chaos_sf2_file.js",var:"_drum_38_0_Chaos_sf2_file",pitch:38},{name:"Hand Clap",file:"12839_0_Chaos_sf2_file.js",var:"_drum_39_0_Chaos_sf2_file",pitch:39},{name:"Snare Drum 2",file:"12840_0_Chaos_sf2_file.js",var:"_drum_40_0_Chaos_sf2_file",pitch:40},{name:"Low Tom 2",file:"12841_0_Chaos_sf2_file.js",var:"_drum_41_0_Chaos_sf2_file",pitch:41},{name:"Closed Hi-hat",file:"12842_0_Chaos_sf2_file.js",var:"_drum_42_0_Chaos_sf2_file",pitch:42},{name:"Low Tom 1",file:"12843_0_Chaos_sf2_file.js",var:"_drum_43_0_Chaos_sf2_file",pitch:43},{name:"Pedal Hi-hat",file:"12844_0_Chaos_sf2_file.js",var:"_drum_44_0_Chaos_sf2_file",pitch:44},{name:"Mid Tom 2",file:"12845_0_Chaos_sf2_file.js",var:"_drum_45_0_Chaos_sf2_file",pitch:45},{name:"Open Hi-hat",file:"12846_0_Chaos_sf2_file.js",var:"_drum_46_0_Chaos_sf2_file",pitch:46},{name:"Mid Tom 1",file:"12847_0_Chaos_sf2_file.js",var:"_drum_47_0_Chaos_sf2_file",pitch:47},{name:"High Tom 2",file:"12848_0_Chaos_sf2_file.js",var:"_drum_48_0_Chaos_sf2_file",pitch:48},{name:"Crash Cymbal 1",file:"12849_0_Chaos_sf2_file.js",var:"_drum_49_0_Chaos_sf2_file",pitch:49},{name:"High Tom 1",file:"12850_0_Chaos_sf2_file.js",var:"_drum_50_0_Chaos_sf2_file",pitch:50},{name:"Ride Cymbal 1",file:"12851_0_Chaos_sf2_file.js",var:"_drum_51_0_Chaos_sf2_file",pitch:51},{name:"Chinese Cymbal",file:"12852_0_Chaos_sf2_file.js",var:"_drum_52_0_Chaos_sf2_file",pitch:52},{name:"Ride Bell",file:"12853_0_Chaos_sf2_file.js",var:"_drum_53_0_Chaos_sf2_file",pitch:53},{name:"Tambourine",file:"12854_0_Chaos_sf2_file.js",var:"_drum_54_0_Chaos_sf2_file",pitch:54},{name:"Splash Cymbal",file:"12855_0_Chaos_sf2_file.js",var:"_drum_55_0_Chaos_sf2_file",pitch:55},{name:"Cowbell",file:"12856_0_Chaos_sf2_file.js",var:"_drum_56_0_Chaos_sf2_file",pitch:56},{name:"Crash Cymbal 2",file:"12857_0_Chaos_sf2_file.js",var:"_drum_57_0_Chaos_sf2_file",pitch:57},{name:"Vibra Slap",file:"12858_0_Chaos_sf2_file.js",var:"_drum_58_0_Chaos_sf2_file",pitch:58},{name:"Ride Cymbal 2",file:"12859_0_Chaos_sf2_file.js",var:"_drum_59_0_Chaos_sf2_file",pitch:59},{name:"High Bongo",file:"12860_0_Chaos_sf2_file.js",var:"_drum_60_0_Chaos_sf2_file",pitch:60},{name:"Low Bongo",file:"12861_0_Chaos_sf2_file.js",var:"_drum_61_0_Chaos_sf2_file",pitch:61},{name:"Mute High Conga",file:"12862_0_Chaos_sf2_file.js",var:"_drum_62_0_Chaos_sf2_file",pitch:62},{name:"Open High Conga",file:"12863_0_Chaos_sf2_file.js",var:"_drum_63_0_Chaos_sf2_file",pitch:63},{name:"Low Conga",file:"12864_0_Chaos_sf2_file.js",var:"_drum_64_0_Chaos_sf2_file",pitch:64},{name:"High Timbale",file:"12865_0_Chaos_sf2_file.js",var:"_drum_65_0_Chaos_sf2_file",pitch:65},{name:"Low Timbale",file:"12866_0_Chaos_sf2_file.js",var:"_drum_66_0_Chaos_sf2_file",pitch:66},{name:"High Agogo",file:"12867_0_Chaos_sf2_file.js",var:"_drum_67_0_Chaos_sf2_file",pitch:67},{name:"Low Agogo",file:"12868_0_Chaos_sf2_file.js",var:"_drum_68_0_Chaos_sf2_file",pitch:68},{name:"Cabasa",file:"12869_0_Chaos_sf2_file.js",var:"_drum_69_0_Chaos_sf2_file",pitch:69},{name:"Maracas",file:"12870_0_Chaos_sf2_file.js",var:"_drum_70_0_Chaos_sf2_file",pitch:70},{name:"Short Whistle",file:"12871_0_Chaos_sf2_file.js",var:"_drum_71_0_Chaos_sf2_file",pitch:71},{name:"Long Whistle",file:"12872_0_Chaos_sf2_file.js",var:"_drum_72_0_Chaos_sf2_file",pitch:72},{name:"Short Guiro",file:"12873_0_Chaos_sf2_file.js",var:"_drum_73_0_Chaos_sf2_file",pitch:73},{name:"Long Guiro",file:"12874_0_Chaos_sf2_file.js",var:"_drum_74_0_Chaos_sf2_file",pitch:74},{name:"Claves",file:"12875_0_Chaos_sf2_file.js",var:"_drum_75_0_Chaos_sf2_file",pitch:75},{name:"High Wood Block",file:"12876_0_Chaos_sf2_file.js",var:"_drum_76_0_Chaos_sf2_file",pitch:76},{name:"Low Wood Block",file:"12877_0_Chaos_sf2_file.js",var:"_drum_77_0_Chaos_sf2_file",pitch:77},{name:"Mute Cuica",file:"12878_0_Chaos_sf2_file.js",var:"_drum_78_0_Chaos_sf2_file",pitch:78},{name:"Open Cuica",file:"12879_0_Chaos_sf2_file.js",var:"_drum_79_0_Chaos_sf2_file",pitch:79},{name:"Mute Triangle",file:"12880_0_Chaos_sf2_file.js",var:"_drum_80_0_Chaos_sf2_file",pitch:80},{name:"Open Triangle",file:"12881_0_Chaos_sf2_file.js",var:"_drum_81_0_Chaos_sf2_file",pitch:81}];function DRUM_GetDrumName(e){for(var _=0;_<DRUMS.length;_++)if(DRUMS[_].file==e)return DRUMS[_].name;return""}function DRUM_GetVariable(e){for(var _=0;_<DRUMS.length;_++)if(DRUMS[_].file==e)return DRUMS[_].var;return""}function DRUM_GetPitch(e){for(var _=0;_<DRUMS.length;_++)if(DRUMS[_].file==e)return DRUMS[_].pitch;return""}function DRUM_GetDrumKeyByName(e){var _=e;"Snare (hit)"==e?_="Snare Drum 1":"Snare (side stick)"==e?_="Snare Drum 2":"Hi-Hat (closed)"==e?_="Closed Hi-hat":"Kick (hit)"==e?_="Bass Drum 2":"Hi-Hat (open)"==e?_="Open Hi-hat":"Pedal Hi-Hat (hit)"==e?_="Pedal Hi-hat":"Crash high (hit)"==e?_="Crash Cymbal 1":"Crash medium (hit)"==e?_="Crash Cymbal 2":"Splash (hit)"==e?_="Splash Cymbal":"Low Tom (hit)"==e?_="Low Tom 1":"Very Low Tom (hit)"==e?_="Low Tom 2":"Hand Clap (hit)"==e?_="Hand Clap":"Castanets (hit)"==e&&(_="Hand Clap");for(var t=0;t<DRUMS.length;t++)if(DRUMS[t].name==_)return DRUMS[t].file;return null}function DrumPlayer(){var self=this;this._audioContext=null,this._player=null,this._onLoadingFinishedCallback=null,this._drum_info_list=[{file:"",var:"",pitch:0},{file:"",var:"",pitch:0},{file:"",var:"",pitch:0},{file:"",var:"",pitch:0}],this.Init=function(){var e=window.AudioContext||window.webkitAudioContext;return self._audioContext=new e,self._player=new WebAudioFontPlayer,self.LoadDefaultDrum(),this},this.LoadDefaultDrum=function(){for(var e={file:"",var:"",pitch:0},_=DEFAULT_SOUND_KEY,t=0;t<DRUMS.length;t++)if(DRUMS[t].file==DEFAULT_SOUND_KEY){e.file=_,e.var=DRUMS[t].var,e.pitch=DRUMS[t].pitch;break}for(t=0;t<self._drum_info_list.length;t++)self._drum_info_list[t]=e;var a="lib/webaudiofontdata/sound/"+_;self._player.loader.startLoad(self._audioContext,a,e.var),self._player.loader.waitLoad((function(){console.log("Default Drum Loading Finished")}))},this.LoadDrum=function(e,_){for(var t={file:"",var:"",pitch:0},a=0;a<DRUMS.length;a++)if(DRUMS[a].file==_){t.file=_,t.var=DRUMS[a].var,t.pitch=DRUMS[a].pitch;break}self._drum_info_list[e]=t;var i="lib/webaudiofontdata/sound/"+_;self._player.loader.startLoad(self._audioContext,i,t.var),self._player.loader.waitLoad((function(){console.log("Drum Loading Finished"),null!=self._onLoadingFinishedCallback&&self._onLoadingFinishedCallback()}))},this.Hit=function(arrow){var idx=0;switch(arrow){case ARROW.LEFT:idx=0;break;case ARROW.DOWN:idx=1;break;case ARROW.UP:idx=2;break;case ARROW.RIGHT:idx=3}self._player.queueWaveTable(self._audioContext,self._audioContext.destination,eval(self._drum_info_list[idx].var),0,self._drum_info_list[idx].pitch,.2,.1)}}function Atlas(){var e=this;this._img=null,this._img_l=null,this._img_d=null,this._img_u=null,this._img_r=null,this._img_l_hit=null,this._img_d_hit=null,this._img_u_hit=null,this._img_r_hit=null,this._img_l_empty=null,this._img_d_empty=null,this._img_u_empty=null,this._img_r_empty=null,this.Init=function(){return e._img=new Image,e._img.src="img/atlas.png",e.LoadSprite(),this},this.LoadSprite=function(){var _=50;e._img_l={x:0,y:0,w:_,h:_},e._img_d={x:_,y:0,w:_,h:_},e._img_u={x:100,y:0,w:_,h:_},e._img_r={x:150,y:0,w:_,h:_},e._img_l_hit={x:0,y:_,w:_,h:_},e._img_d_hit={x:_,y:_,w:_,h:_},e._img_u_hit={x:100,y:_,w:_,h:_},e._img_r_hit={x:150,y:_,w:_,h:_},e._img_l_empty={x:0,y:100,w:_,h:_},e._img_d_empty={x:_,y:100,w:_,h:_},e._img_u_empty={x:100,y:100,w:_,h:_},e._img_r_empty={x:150,y:100,w:_,h:_}}}const ARROW={LEFT:37,UP:38,RIGHT:39,DOWN:40},DIMENSION={_2D:0,_3D:1},LEFT_BIT=1,UP_BIT=2,RIGHT_BIT=4,DOWN_BIT=8,DEFAULT_SOUND_KEY="12844_0_Chaos_sf2_file.js",LAYOUT={INFO:0,PLAY:1,RECORD:2},MOVE_DIRECTION={UPWARD:0,DOWNWARD:1},RENDER_MODE={PLAY:0,RECORD:1},GAME_TYPE={DDR:0,Dash:1};function GetURLParam(e){var _=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null==_?null:decodeURI(_[1])||0}function ConvertSecondsForDiaplsy(e){var _=e%60;return parseInt(e/60)+":"+(_<10?"0"+_:_)}function GetVideoIDFromURL(e){var _="";if(e.startsWith("https://www.youtube.com/watch?"))for(var t=e.split("?")[1].split("&"),a=0;t.length;a++){var i=t[a].split("=")[0],s=t[a].split("=")[1];if("v"==i){_=s;break}}else if(e.startsWith("https://youtu.be/")){_=e.substring("https://youtu.be/".length)}else _=e;return _}function Timer(){var e=this;this._tick=null,this._delta=0,this.Init=function(){return e._tick=Date.now(),e.Update(),this},this.Update=function(){var _=Date.now();e._delta=_-e._tick,e._tick=_,requestAnimationFrame(e.Update)}}function onYouTubeIframeAPIReady(){console.log("onYouTubeIframeAPIReady"),_yt_player.Ready()}function YoutubePlayer(){var e=this;this._is_player_ready=!1,this._player=null,this._video_id=null,this._is_flow_controlling=!1,this._timer=null,this._is_playing=!1,this._cb_on_youtube_ready=null,this._cb_on_flow_event=null,this._cb_on_player_ready=null,this._cb_on_player_state_changed=null,this.Init=function(){console.log("YoutubePlayer Init");var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var _=document.getElementsByTagName("script")[0];return _.parentNode.insertBefore(e,_),this},this.SetEventListener=function(_,t,a,i){console.log("SetEventListener"),e._cb_on_youtube_ready=_,e._cb_on_flow_event=t,e._cb_on_player_ready=a,e._cb_on_player_state_changed=i},this.Ready=function(){console.log("Ready"),e._cb_on_youtube_ready&&e._cb_on_youtube_ready(),null!=e._video_id&&e.LoadVideo(e._video_id)},this.LoadVideo=function(_){if(null==e._player)e._video_id=_,e._player=new YT.Player("player",{height:"240",width:"320",videoId:e._video_id,events:{onReady:e.OnPlayerReady,onStateChange:e.OnPlayerStateChange}});else{if(e._video_id==_)return;e._video_id=_,e._player.loadVideoById(_)}},this.OnPlayerReady=function(){e._is_player_ready=!0;var _=e._player.getAvailablePlaybackRates(),t=e._player.getDuration(),a=e._player.getVolume();e._cb_on_player_ready&&e._cb_on_player_ready(_,t,a)},this.OnPlayerStateChange=function(_){switch(_.data){case YT.PlayerState.ENDED:e.FlowControlStop(),e._is_playing=!1;break;case YT.PlayerState.PLAYING:e.FlowControlStart(),e._is_playing=!0;break;case YT.PlayerState.PAUSED:case YT.PlayerState.BUFFERING:case YT.PlayerState.CUED:e.FlowControlStop(),e._is_playing=!1}e._cb_on_player_state_changed&&(console.log("self._is_playing "+e._is_playing),e._cb_on_player_state_changed(e._is_playing))},this.SeekAndPlay=function(_){e._player.cueVideoById({videoId:e._video_id,startSeconds:_/1e3}),e._player.playVideo()},this.FlowControlStart=function(){e._is_flow_controlling||(e._is_flow_controlling=!0,e._timer=setInterval(e.FlowControl,100))},this.FlowControlStop=function(){e._is_flow_controlling=!1,clearInterval(e._timer)},this.FlowControl=function(){var _=e._player.getCurrentTime();e._cb_on_flow_event&&e._cb_on_flow_event(_)},this.Play=function(){0==e._is_playing&&null!=e._player&&e._player.playVideo()},this.Stop=function(){null!=e._player&&e._player.stopVideo()},this.Pause=function(){e._is_playing&&e._player&&e._player.pauseVideo()},this.IsPlaying=function(){return e._is_playing},this.ChangeSpeed=function(_){var t=parseFloat(_);console.log(t),e._player.setPlaybackRate(parseFloat(t))},this.SetVolume=function(_){e._player.setVolume(_)},this.SetPlaybackQuality=function(){e._player.setPlaybackQuality("small")}}function Renderer(e,_,t,a){var i=this;this._canvas=null,this._ctx=null,this._base_line=600,this._debug=!1,this._score=0,this._render_mode=RENDER_MODE.RECORD,this._game_width=e,this._game_height=_,this._screen_width=t,this._screen_height=a,this._show_index_number=!1,this._progress_percent=0,this._particle_list=[],this.Init=function(){i._canvas=document.getElementById("ddr_player_layer1"),i._canvas.width=i._screen_width,i._canvas.height=i._screen_height,console.log("self._canvas "+i._canvas),i._ctx=i._canvas.getContext("2d");var e=i._screen_width/i._game_width,_=i._screen_height/i._game_height;return console.log("scale_width "+e),console.log("scale_height "+_),i._ctx.scale(e,_),i._render_mode==RENDER_MODE.PLAY?(i.DrawBaseLine(),i.DrawVerticalLine(),i.DrawEmpty(),i.DrawScore()):i._render_mode==RENDER_MODE.RECORD&&(i.DrawBaseLine(),i.DrawVerticalLine(),i.DrawEmpty()),this},this.Update=function(e,_){i._ctx.clearRect(0,0,i._game_width,i._game_height),i.DrawBaseLine(),i.DrawVerticalLine(),i._render_mode==RENDER_MODE.PLAY&&(i.DrawHit(),i.DrawProgress()),i.DrawEmpty();for(var t=i._particle_list.length-1;t>=0;t--)i._particle_list[t].IsEnd()?i._particle_list.splice(t,1):i._particle_list[t].Update();i.DrawObjs(e,_),i._render_mode==RENDER_MODE.PLAY&&i.DrawScore()},this.UpdateScore=function(e){i._score=e},this.UpdateProgress=function(e){i._progress_percent=e},this.DrawProgress=function(){var e=i._game_width*i._progress_percent;i.DrawLineWidth(0,0,e,0,"red",20)},this.DrawObjs=function(e,_){for(var t=_;t<e.length;t++){var a=e[t];if(!a._is_hit&&!a._passed&&(!(a._y<-100||a._y>700)&&(i.DrawLine(0,a._y+a._h/2,i._game_width,a._y+a._h/2,"#aaa"),i._ctx.drawImage(_atlas._img,a._img.x,a._img.y,a._img.w,a._img.h,a._x,a._y,a._w,a._h),i._show_index_number))){var s=a._x+a._w/2,o=a._y+a._h/2;i.DrawText(a._order+1,s,o,25)}}},this.DrawBaseLine=function(){i._render_mode==RENDER_MODE.PLAY?(i._debug&&(i.DrawLine(0,100,i._game_width,100,"#aaa"),i.DrawLine(0,200,i._game_width,200,"#aaa"),i.DrawLine(0,300,i._game_width,300,"#aaa"),i.DrawLine(0,400,i._game_width,400,"#aaa"),i.DrawLine(0,500,i._game_width,500,"#aaa")),i.DrawLine(0,i._base_line,i._game_width,i._base_line,"RED")):i._render_mode==RENDER_MODE.RECORD&&(i._debug&&(i.DrawLine(0,200,i._game_width,200,"#aaa"),i.DrawLine(0,300,i._game_width,300,"#aaa"),i.DrawLine(0,400,i._game_width,400,"#aaa"),i.DrawLine(0,500,i._game_width,500,"#aaa"),i.DrawLine(0,600,i._game_width,600,"#aaa")),i.DrawLine(0,i._base_line,i._game_width,i._base_line,"RED"))},this.DrawLine=function(e,_,t,a,s){i._ctx.beginPath(),i._ctx.moveTo(e,_),i._ctx.lineTo(t,a),i._ctx.lineWidth=1,i._ctx.strokeStyle=s,i._ctx.stroke()},this.DrawLineWidth=function(e,_,t,a,s,o){i._ctx.beginPath(),i._ctx.moveTo(e,_),i._ctx.lineTo(t,a),i._ctx.lineWidth=1,i._ctx.strokeStyle=s,i._ctx.lineWidth=o,i._ctx.stroke()},this.DrawVerticalLine=function(){var e=i._game_width/4;i.DrawLine(e,0,e,i._game_height,"#aaa"),i.DrawLine(2*e,0,2*e,i._game_height,"#aaa"),i.DrawLine(3*e,0,3*e,i._game_height,"#aaa")},this.DrawEmpty=function(){var e=i._game_width/4,_=e/2;i._ctx.drawImage(_atlas._img,_atlas._img_l_empty.x,_atlas._img_l_empty.y,_atlas._img_l_empty.w,_atlas._img_l_empty.h,_-32.5,i._base_line-32.5,65,65),i._ctx.drawImage(_atlas._img,_atlas._img_d_empty.x,_atlas._img_d_empty.y,_atlas._img_d_empty.w,_atlas._img_d_empty.h,_+e-32.5,i._base_line-32.5,65,65),i._ctx.drawImage(_atlas._img,_atlas._img_u_empty.x,_atlas._img_u_empty.y,_atlas._img_u_empty.w,_atlas._img_u_empty.h,_+2*e-32.5,i._base_line-32.5,65,65),i._ctx.drawImage(_atlas._img,_atlas._img_r_empty.x,_atlas._img_r_empty.y,_atlas._img_r_empty.w,_atlas._img_r_empty.h,_+3*e-32.5,i._base_line-32.5,65,65)},this._hit_left=!1,this._hit_up=!1,this._hit_right=!1,this._hit_down=!1,this._hit_step_left=0,this._hit_step_up=1,this._hit_step_right=1,this._hit_step_down=1,this._hit_left_dur=0,this._hit_up_dur=0,this._hit_right_dur=0,this._hit_down_dur=0,this._hit_result_left=null,this._hit_result_up=null,this._hit_result_right=null,this._hit_result_dopwn=null,this._hit_combo=!1,this._hit_combo_dur=0,this._hit_combo_count=0,this.Hit=function(e,_,t){var a=i._game_width/4,s=a/2;e==ARROW.LEFT&&(i._hit_left=!0,console.log("HIT LEFT "+!0),i._hit_left_dur=Date.now(),i._hit_result_left=_,i._hit_step_left=1.3,i.CreateParticles(s,i._base_line)),e==ARROW.UP&&(i._hit_up=!0,i._hit_up_dur=Date.now(),i._hit_result_up=_,i._hit_step_up=1,i.CreateParticles(2*a+s,i._base_line)),e==ARROW.RIGHT&&(i._hit_right=!0,i._hit_right_dur=Date.now(),i._hit_result_right=_,i._hit_step_right=1,i.CreateParticles(3*a+s,i._base_line)),e==ARROW.DOWN&&(i._hit_down=!0,i._hit_down_dur=Date.now(),i._hit_result_down=_,i._hit_step_down=1,i.CreateParticles(a+s,i._base_line)),t>1?(i._hit_combo=!0,i._hit_combo_dur=Date.now(),i._hit_combo_count=t):i._hit_combo=!1},this.CreateParticles=function(e,_){for(var t=0;t<30;t++){var a=new Particle(e,_).Init();a._ctx=i._ctx,i._particle_list.push(a)}},this.DrawHit=function(){i._game_width;if(i._hit_left){_atlas._img_l_hit.w,i._hit_step_left;var e=_atlas._img_l_hit.h*i._hit_step_left;i._base_line;i._hit_step_left=i._hit_step_left+.12;var _=80,t=i._base_line;i.DrawText(i._hit_result_left.text,_,t+50,26,"blue"),i.DrawText(i._hit_result_left.score,_,t+80,26,"blue"),Date.now()-i._hit_left_dur>200&&(i._hit_left=!1)}if(i._hit_down){_atlas._img_d_hit.w,i._hit_step_down,e=_atlas._img_d_hit.h*i._hit_step_down,i._base_line;i._hit_step_down=i._hit_step_down+.12;_=160,t=i._base_line;i.DrawText(i._hit_result_down.text,_,t+50,26,"blue"),i.DrawText(i._hit_result_down.score,_,t+80,26,"blue"),Date.now()-i._hit_down_dur>200&&(i._hit_down=!1)}if(i._hit_up){_atlas._img_u_hit.w,i._hit_step_up,e=_atlas._img_u_hit.h*i._hit_step_up,i._base_line;i._hit_step_up=i._hit_step_up+.12;_=240,t=i._base_line;i.DrawText(i._hit_result_up.text,_,t+50,26,"blue"),i.DrawText(i._hit_result_up.score,_,t+80,26,"blue"),Date.now()-i._hit_up_dur>200&&(i._hit_up=!1)}if(i._hit_right){_atlas._img_r_hit.w,i._hit_step_right,e=_atlas._img_r_hit.h*i._hit_step_right,i._base_line;i._hit_step_right=i._hit_step_right+.12;_=320,t=i._base_line;i.DrawText(i._hit_result_right.text,_,t+50,26,"blue"),i.DrawText(i._hit_result_right.score,_,t+80,26,"blue"),Date.now()-i._hit_right_dur>200&&(i._hit_right=!1)}},this.DrawText=function(e,_,t,a,s){var o=new Number(a);i._ctx.textBaseline="middle",i._ctx.font=o+"px Arial",i._ctx.textAlign="center",i._ctx.fillStyle=s,i._ctx.fillText(e,_,t)},this.DrawScore=function(){if(i.DrawText(i._score,200,50,50,"red"),i._hit_combo){var e=i._hit_combo_count-1+" COMBO";e+="\n +"+10*(i._hit_combo_count-1),i.DrawText(e,200,220,25,"blue")}},this.DisplayResult=function(e){e?(i.DrawText("Congraturations!",202,302,50,"White"),i.DrawText("Congraturations!",200,300,50,"Red"),i.DrawText("Your New Score",202,352,33,"White"),i.DrawText("Your New Score",200,350,33,"Red"),i.DrawText("Score "+i._score,202,402,33,"White"),i.DrawText("Score "+i._score,200,400,33,"Blue")):(i.DrawText("Oops!",202,302,50,"White"),i.DrawText("Oops!",200,300,50,"Red"))}}function Particle(e,_){var t=this;this._ctx=null,this._x=e,this._y=_,this._w=10,this._h=10,this._rotate_speed=1,this._move_x=1,this._move_y=1,this._degree=0,this._alpha=1,this._start_ms=Date.now(),this._life_ms=500,this.Init=function(){t._rotate_speed=t.Random(-30,30);var e=t.Random(10,30);return t._w=t._h=e,t._move_x=t.Random(-10,10),t._move_y=t.Random(-10,10),this},this.Random=function(e,_){return Math.random()*(_-e)+e},this.Update=function(){t._degree+=t._rotate_speed,t._x+=t._move_x,t._y+=t._move_y,t._alpha-=.03,t._alpha<0&&(t._alpha=0),t.Draw()},this.Draw=function(){var e=t._x+t._w/2,_=t._y+t._h/2;t._ctx.save(),t._ctx.translate(e,_),t._ctx.rotate(t._degree*Math.PI/180),t._ctx.translate(-e,-_),t._ctx.lineWidth=1,t._ctx.fillStyle="white",t._ctx.strokeStyle="black",t._ctx.globalAlpha=t._alpha,t._ctx.fillRect(t._x,t._y,t._w,t._h),t._ctx.strokeRect(t._x,t._y,t._w,t._h),t._ctx.restore()},this.IsEnd=function(){return Date.now()-t._start_ms>t._life_ms}}function GameData(e,_){var t=this;this._game_type=null,this._speed=150,this._base_line=100,this._beat_list=[],this._wave_list=[],this._game_objs=[],this._dimension=e,this._move_direction=_,this._note_order=0,this.Init=function(){return this},this.SetGameType=function(e){t._game_type=e},this.SetWaveNBeat=function(e){t._wave_list=e.wave_list,t._beat_list=e.beat_list},this.GetWaveNBeat=function(){return{wave_list:t._wave_list,beat_list:t._beat_list}},this.AddWave=function(e){t._wave_list.push(e),t.SortWaveList()},this.AddBall=function(e){t._beat_list.push(e),t.SortBeatList(),t.CreateNotes(e)},this.SortBeatList=function(){t._beat_list.sort((function(e,_){return e.t-_.t}))},this.SortWaveList=function(){t._wave_list.sort((function(e,_){return e-_}))},this.UpdateGameObject=function(e){for(var _=t._game_objs.length-1;_>=0;_--){var a=t._game_objs[_];e.t==a._offset_ms&&t._game_objs.splice(_,1)}t.CreateNotes(e)},this.AddOrRemoveBall=function(e,_){var a=t._beat_list[e],i=0;switch(a.m&LEFT_BIT&&i++,a.m&UP_BIT&&i++,a.m&RIGHT_BIT&&i++,a.m&DOWN_BIT&&i++,_){case 1:a.m&LEFT_BIT?a.m^=LEFT_BIT:i<2&&(a.m|=LEFT_BIT);break;case 2:a.m&DOWN_BIT?a.m^=DOWN_BIT:i<2&&(a.m|=DOWN_BIT);break;case 3:a.m&UP_BIT?a.m^=UP_BIT:i<2&&(a.m|=UP_BIT);break;case 4:a.m&RIGHT_BIT?a.m^=RIGHT_BIT:i<2&&(a.m|=RIGHT_BIT)}t.UpdateGameObject(a)},this.UpdateGameObjectOffset=function(e,_,a){for(var i=0;i<t._game_objs.length;i++)t._game_objs[i]._offset_ms==e&&(t._game_objs[i].ChangeOffset(_),t._game_objs[i].Update(a))},this.CreateGameObjects=function(e){switch(e){case 1:t._speed=150;break;case 2:t._speed=160;break;case 3:t._speed=170;break;case 4:t._speed=180;break;case 5:t._speed=190;break;case 6:t._speed=200;break;case 7:t._speed=210}t._note_order=0,t._game_objs=[];for(var _=0;_<t._beat_list.length;_++)t.CreateNotes(t._beat_list[_])},this.CreateGameObjectsWithGivenTime=function(e){t._note_order=0,t._game_objs=[];for(var _=0;_<t._beat_list.length;_++)t.CreateNotes(t._beat_list[_],e)},this.CreateNotes=function(e,_){t._game_type==GAME_TYPE.DDR?t.CreateNotes_DDR(e,_):t._game_type==GAME_TYPE.Dash&&t.CreateNotes_Dash(e,_),t._note_order++},this.CreateNotes_DDR=function(e,_){if(e.m&LEFT_BIT){var a=null;t._dimension==DIMENSION._2D?a=new Ball(t._game_type,ARROW.LEFT,e.t,t._speed,t._base_line,t._move_direction,t._note_order).Init():t._dimension==DIMENSION._3D&&(a=new ThreeNote(ARROW.LEFT,e.t,t._speed,t._base_line).Init()),null!=_&&a.UpdatePos(_),t._game_objs.push(a)}if(e.m&UP_BIT){a=null;t._dimension==DIMENSION._2D?a=new Ball(t._game_type,ARROW.UP,e.t,t._speed,t._base_line,t._move_direction,t._note_order).Init():t._dimension==DIMENSION._3D&&(a=new ThreeNote(ARROW.UP,e.t,t._speed,t._base_line).Init()),null!=_&&a.UpdatePos(_),t._game_objs.push(a)}if(e.m&RIGHT_BIT){a=null;t._dimension==DIMENSION._2D?a=new Ball(t._game_type,ARROW.RIGHT,e.t,t._speed,t._base_line,t._move_direction,t._note_order).Init():t._dimension==DIMENSION._3D&&(a=new ThreeNote(ARROW.RIGHT,e.t,t._speed,t._base_line).Init()),null!=_&&a.UpdatePos(_),t._game_objs.push(a)}if(e.m&DOWN_BIT){a=null;t._dimension==DIMENSION._2D?a=new Ball(t._game_type,ARROW.DOWN,e.t,t._speed,t._base_line,t._move_direction,t._note_order).Init():t._dimension==DIMENSION._3D&&(a=new ThreeNote(ARROW.DOWN,e.t,t._speed,t._base_line).Init()),null!=_&&a.UpdatePos(_),t._game_objs.push(a)}},this.CreateNotes_Dash=function(e,_){var a=new Ball(t._game_type,ARROW.LEFT,e.t,t._speed,t._base_line,t._move_direction,t._note_order).Init();null!=_&&a.UpdatePos(_),t._game_objs.push(a)},this.DeleteWave=function(e){t._wave_list.splice(e,1)},this.DeleteBeat=function(e){var _=t._beat_list[e];t._beat_list.splice(e,1);for(var a=t._game_objs.length-1;a>=0;a--)_.t==t._game_objs[a]._offset_ms&&t._game_objs.splice(a,1)},this.PrependBeat=function(e){if(e>=t._beat_list.length||e<0)console.log(e+" out of range");else{var _=null;if(0==e){var a=t._beat_list[e+1].t-t._beat_list[e].t;t._game_type==GAME_TYPE.DDR?_={t:t._beat_list[e].t-a,m:LEFT_BIT}:t._game_type==GAME_TYPE.Dash&&(_={t:t._beat_list[e].t-a,n:1})}else{var i=(t._beat_list[e-1].t-t._beat_list[e].t)/2;i=Math.abs(i),i=Math.floor(i),console.log("half "+i),t._game_type==GAME_TYPE.DDR?_={t:t._beat_list[e].t-i,m:LEFT_BIT}:t._game_type==GAME_TYPE.Dash&&(_={t:t._beat_list[e].t-i,n:1}),console.log("beat_info.t "+_.t)}null!=_&&t.AddBall(_)}},this.PrependWave=function(e){e>=t._beat_list.length||e<0?console.log(e+" out of range"):t.AddWave(t._beat_list[e].t)},this.Shift=function(e){for(var _=0;_<t._beat_list.length;_++)t._beat_list[_].t+=e},this.DeleteFrom=function(e){t._beat_list.splice(e,t._beat_list.length)},this.ClearNoteList=function(){t._wave_list=[],t._beat_list=[]}}function GameControl(e,_){var t=this;this._width=e,this._height=_,this._base_line=100,this._timelapse=0,this._timelapse_youtube=0,this._game_started=!1,this._is_playing=!1,this._duration_sec=0,this._score=0,this._game_data=null,this._video_id="",this._cb_on_youtube_stopped=null,this._cb_on_game_finished=null,this._cb_on_youtube_video_ready_to_play=null,this._late_play=!1,this._combo=0,this._gameobj_begin_idx=0,this._finish_notified=!1,this._id_debug_ele=null,this._vibration_on_off=!1,this._base_offset_ms=0,this._game_level=1,this._is_complete=!1,this._is_excercise_mode=!1,this._total_hit_count=0,this._game_type=null,this._cur_wave_idx=0,this.Init=function(){return console.log("GameControl Init"),t._id_debug_ele=$("#id_debug"),_yt_player.SetEventListener(t.YT_OnYoutubeReady,t.YT_OnFlowEvent,t.YT_OnPlayerReady,t.YT_OnPlayerStateChange),t._game_data=new GameData(DIMENSION._2D,MOVE_DIRECTION.UPWARD),t.InitKeyHandle(),t.Update(),this},this.SetGameType=function(e){console.log("Game Type "+e),t._game_type=e,t._game_data.SetGameType(e)},this.SetVideoID=function(e){t._video_id=e},this.YT_OnYoutubeReady=function(){console.log("YT_OnYoutubeReady"),console.log("self._video_id "+t._video_id),""!=t._video_id&&_yt_player.LoadVideo(t._video_id)},this.YT_OnPlayerReady=function(e,_){t._duration_sec=_,console.log("YT_OnPlayerReady "+_),null!=t._cb_on_youtube_video_ready_to_play&&saelf._cb_on_youtube_video_ready_to_play(),_yt_player.SetPlaybackQuality(),1==t._late_play&&(t._late_play=!1,_yt_player.Play())},this.YT_OnPlayerStateChange=function(e){console.log("is_play "+e),e?(t._timelapse=0,t._timelapse_youtube=0,t._is_playing=!0,t._is_complete=!1,t._total_hit_count=0):(t._cb_on_youtube_stopped&&(console.log("_cb_on_youtube_stopped "),t._cb_on_youtube_stopped()),t._is_playing=!1)},this.YT_OnFlowEvent=function(e){e=parseInt(1e3*e),t._timelapse_youtube=e},this._touch_count=0,this._prev_left_touch_ts=0,this._prev_down_touch_ts=0,this._prev_up_touch_ts=0,this._prev_right_touch_ts=0,this.InitKeyHandle=function(){$("#ddr_player_layer1").on("touchmove",(function(e){e.preventDefault()})),$("#ddr_player_layer1").on("touchstart",(function(e){if(0!=t._is_playing){for(var _=window.innerWidth/4,a=[],i=0;i<e.originalEvent.touches.length;i++)for(var s=1;s<=4;s++)if(e.originalEvent.touches[i].pageX<_*s){switch(s){case 1:Date.now()-t._prev_left_touch_ts>100&&a.push(ARROW.LEFT),t._prev_left_touch_ts=Date.now();break;case 2:Date.now()-t._prev_down_touch_ts>100&&a.push(ARROW.DOWN),t._prev_down_touch_ts=Date.now();break;case 3:Date.now()-t._prev_up_touch_ts>100&&a.push(ARROW.UP),t._prev_up_touch_ts=Date.now();break;case 4:Date.now()-t._prev_right_touch_ts>100&&a.push(ARROW.RIGHT),t._prev_right_touch_ts=Date.now()}break}t._touch_count+=a.length,a.length>0&&t.Hit(a,t._timelapse)}})),document.addEventListener("keydown",(function(e){switch(e.keyCode){case ARROW.LEFT:case ARROW.UP:case ARROW.RIGHT:case ARROW.DOWN:e.preventDefault();var _=[e.keyCode];t.Hit(_,t._timelapse)}}))},this._hit_queue=[],this.Hit=async function(e,_){if(0!=t._is_playing)return _+=t._base_offset_ms,new Promise((function(a,i){for(var s=[],o=0;o<e.length;o++)for(var n=0;n<t._game_data._game_objs.length;n++){var l=t._game_data._game_objs[n];if(!l._is_hit&&!l._passed&&l._arrow_or_num==e[o]){s[o]=l;break}}var r=!1;if(2==e.length&&2==s.length&&s[0]._offset_ms==s[1]._offset_ms&&(r=!0),r){var d=s[0].HitNote(e[0],_);for(o=0;o<e.length;o++){if(t._score+=d.score,"Perfect"==d.text){if(t._combo++,t._combo>1){var h=10*(t._combo-1);t._score+=h}}else t._combo=0;t._hit_queue.push({arrow:c,hit_result:d,combo:t._combo}),1==d.hit&&(t._total_hit_count+=2)}}else for(o=0;o<e.length;o++){var c=e[o],m=s[o];if(null==m||null==m){d={hit:!1,score:-10,text:"Miss"};t._score+=d.score,t._combo=0,t._hit_queue.push({arrow:c,hit_result:d,combo:0})}else{d=m.HitNote(c,_);if(t._score+=d.score,"Perfect"==d.text){if(t._combo++,t._combo>1){h=10*(t._combo-1);t._score+=h}}else t._combo=0;t._hit_queue.push({arrow:c,hit_result:d,combo:t._combo}),1==d.hit&&t._total_hit_count++}}}))},this.SetWaveNBeat=function(e){t._game_data.SetWaveNBeat(e)},this.PrepareGame=function(){t._game_data.CreateGameObjects(t._game_level)},this.PlayGame=function(){console.log("play game "),1!=t._game_started&&(t._game_started=!0,_renderer._base_line=t._base_line,_renderer._render_mode=RENDER_MODE.PLAY,console.log("_renderer._render_mode  "+_renderer._render_mode),t._game_data._base_line=t._base_line,t._timelapse=0,t._timelapse_youtube=0,t._score=0,t._combo=0,t._gameobj_begin_idx=0,t._finish_notified=!1,_renderer._hit_combo=!1,_renderer.UpdateScore(t._score),_yt_player.SetEventListener(t.YT_OnYoutubeReady,t.YT_OnFlowEvent,t.YT_OnPlayerReady,t.YT_OnPlayerStateChange),0==_yt_player._is_player_ready?(_yt_player.LoadVideo(t._video_id),t._late_play=!0):_yt_player.Play())},this.PauseGame=function(){_yt_player.Pause()},this.StopGame=function(){console.log("StopGame "),_yt_player.Stop(),t._game_started=!1,t._is_playing=!1,t._finish_notified=!0},this._delta=0,this._tick=0,this._failed_gameobj_list=[],this.Update=function(){var e=Date.now();if(t._delta=e-t._tick,t._tick=e,t._is_playing){if(t._timelapse+=t._delta,t._timelapse_youtube+=t._delta,t._timelapse>t._timelapse_youtube){var _=t._timelapse-t._timelapse_youtube;t._timelapse-=_/20}else if(t._timelapse<t._timelapse_youtube){_=t._timelapse_youtube-t._timelapse;t._timelapse+=_/20}for(var a=t._gameobj_begin_idx;a<t._game_data._game_objs.length;a++){var i=t._game_data._game_objs[a];if(i._passed&&(t._gameobj_begin_idx=a+1,0==t._is_excercise_mode&&0==i._is_hit)){i._is_fail_cause=!0,i._passed=!1,t._finish_notified=!0,t._failed_gameobj_list=[],t._failed_gameobj_list=t._game_data._game_objs,t._cb_on_game_finished&&t._cb_on_game_finished(t._is_complete);break}if(0==i.Update(t._timelapse+t._base_offset_ms))break}if(t._hit_queue.length>0){var s=t._hit_queue[0];_renderer.Hit(s.arrow,s.hit_result,s.combo),console.log("hit.hit_result.hit "+s.hit_result.hit),0==t._is_excercise_mode&&0==s.hit_result.hit&&(t._finish_notified=!0,t._failed_gameobj_list=[],t._failed_gameobj_list=t._game_data._game_objs,t._cb_on_game_finished&&t._cb_on_game_finished(t._is_complete),console.log("FAILED GAME ")),1==t._hit_queue.length&&t._vibration_on_off&&t.VibrateAsync(s.hit_result.score,s.combo),t._hit_queue.splice(0,1)}var o=t._total_hit_count/t._game_data._game_objs.length;_renderer.UpdateProgress(o),_renderer.UpdateScore(t._score),_renderer.Update(t._game_data._game_objs,t._gameobj_begin_idx),t._game_data._game_objs.length==t._total_hit_count&&0==t._finish_notified&&(t._finish_notified=!0,t._is_complete=!0,t._cb_on_game_finished&&t._cb_on_game_finished(t._is_complete)),t.UpdateWave()}t._finish_notified&&(_renderer.UpdateScore(t._score),0==t._is_complete&&_renderer.Update(t._failed_gameobj_list,0),_renderer.DisplayResult(t._is_complete)),requestAnimationFrame(t.Update)},this._color_table=["#3d5a80","#98c1d9","#e0fbfc","#ee6c4d","#84a59d","#00b4d8","#f1c453","#e6beae"],this.UpdateWave=function(){if(!(t._cur_wave_idx>=t._game_data._wave_list.length)){var e=parseInt(Math.random()*t._color_table.length);t._timelapse>=t._game_data._wave_list[t._cur_wave_idx]&&($("#ddr_player_bg_layer").css("background-color",t._color_table[e]),t._cur_wave_idx++)}},this.VibrateAsync=function(e,_){return new Promise((function(){var t=e;switch(e){case 6:t=20;break;case 7:t=30;break;case 8:t=50;break;case 9:t=80;break;case 10:t=100}_>1&&(t+=10*_)>200&&(t=200),window.navigator.vibrate(t)}))}}function Ball(e,_,t,a,i,s,o){var n=this;this._game_type=e,this._arrow_or_num=_,this._img=null,this._x=0,this._y=-990,this._w=50,this._h=50,this._speed=a,this._offset_ms=t,this._offset_px_init=0,this._base_line_px=i,this._passed=!1,this._hit_y=0,this._x_base=0,this._is_hit=!1,this._move_direction=s,this._is_fail_cause=!1,this._order=o,this.Init=function(){return n._game_type==GAME_TYPE.DDR?n._arrow_or_num==ARROW.LEFT?(n._img=_atlas._img_l,n._x_base=50):n._arrow_or_num==ARROW.DOWN?(n._img=_atlas._img_d,n._x_base=150):n._arrow_or_num==ARROW.UP?(n._img=_atlas._img_u,n._x_base=250):n._arrow_or_num==ARROW.RIGHT&&(n._img=_atlas._img_r,n._x_base=350):n._game_type==GAME_TYPE.Dash&&(n._img=_atlas._img_l,n._x_base=50),n._x=n._x_base-n._w/2,n.CalcOffsetPixel(),this},this.CalcOffsetPixel=function(){n._offset_px_init=n._offset_ms/1e3*n._speed,n._offset_px_init=n._base_line_px+n._offset_px_init,n._offset_px_init=n._offset_px_init-n._h/2},this.ChangeOffset=function(e){n._offset_ms=e,n.CalcOffsetPixel()},this.Update=function(e){if(!n._passed)return!(Math.abs(e-n._offset_ms)>5e3)&&(n.UpdatePos(e),n._move_direction==MOVE_DIRECTION.UPWARD?n._hit_y<40&&(n._passed=!0):(n._move_direction,MOVE_DIRECTION.DOWNWARD),!0)},this.UpdatePos=function(e){var _=e/1e3*n._speed;n._move_direction==MOVE_DIRECTION.DOWNWARD?n._y=n._offset_px_init+_:n._y=n._offset_px_init-_,n._hit_y=n._y+n._h/2},this.Destroy=function(){},this.HitNote=function(e,_){var t={hit:!1,score:0,text:""};return n._arrow_or_num!=e?t:t=n.CheckHitByTime(_)},this.CheckHitByTime=function(e){var _={hit:!1,score:0,text:""},t=Math.abs(e-n._offset_ms);return 0<=t&&t<=300&&(n._is_hit=!0),0<=t&&t<100?(_.score=10,_.text="Perfect",_.hit=!0):100<=t&&t<150?(_.score=9,_.text="Excellent",_.hit=!0):150<=t&&t<200?(_.score=8,_.text="Very Good",_.hit=!0):200<=t&&t<250?(_.score=7,_.text="Good",_.hit=!0):250<=t&&t<=300?(_.score=6,_.text="Not Bad",_.hit=!0):300<t&&(_.score=-10,_.text="Miss",_.hit=!1),_},this.CheckHitByPixel=function(){var e={hit:!1,score:0,text:""},_=Math.abs(n._base_line_px-n._hit_y);return _<60?(e.hit=!0,n._w=2*n._w,n._h=2*n._h,n._x=n._x_base-n._w/2,n._arrow_or_num==ARROW.LEFT?n._img=_atlas._img_l_hit:n._arrow_or_num==ARROW.DOWN?n._img=_atlas._img_d_hit:n._arrow_or_num==ARROW.UP?n._img=_atlas._img_u_hit:n._arrow_or_num==ARROW.RIGHT&&(n._img=_atlas._img_r_hit),0<=_&&_<15?(e.score=10,e.text="Perfect"):15<=_&&_<20?(e.score=9,e.text="Excellent"):20<=_&_<25?(e.score=8,e.text="Very Good"):25<=_&_<30?(e.score=7,e.text="Good"):30<=_&_<=60&&(e.score=6,e.text="Not Bad"),n._is_hit=!0):(e.score=-10,e.text="Miss"),e}}function GameMaker(){var e=this;this._is_playing=!1,this._duration_sec=0,this._base_line=600,this._timelapse=0,this._game_data=null,this._video_id="",this._selected_note_idx=-1,this._is_jump_play=!1,this._game_type=null,this.Init=function(){return _yt_player.SetEventListener(e.YT_OnYoutubeReady,e.YT_OnFlowEvent,e.YT_OnPlayerReady,e.YT_OnPlayerStateChange),e.InitKeyHandle(),e.InitTouchHandle(),e.InitComponentHandle(),e.Update(),e._game_data=new GameData(DIMENSION._2D,MOVE_DIRECTION.UPWARD),e._game_data._base_line=e._base_line,this},this.SetGameType=function(_){e._game_type=_,e._game_data.SetGameType(_)},this.InitKeyHandle=function(){document.addEventListener("keydown",(function(_){if(console.log("e.keyCode "+_.keyCode),e._game_type==GAME_TYPE.Dash)switch(_.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:e.Dash_Record(_.keyCode,e._timelapse)}else if(e._game_type==GAME_TYPE.DDR)switch(_.keyCode){case 48:e.DDR_RecordRandom(2,e._timelapse);break;case 74:e.DDR_Record(ARROW.LEFT,e._timelapse);break;case 75:e.DDR_Record(ARROW.DOWN,e._timelapse);break;case 76:e.DDR_Record(ARROW.UP,e._timelapse);break;case 186:e.DDR_Record(ARROW.RIGHT,e._timelapse);break;default:e.DDR_RecordRandom(1,e._timelapse)}}))},this._touch_count=0,this._prev_left_touch_ts=0,this._prev_down_touch_ts=0,this._prev_up_touch_ts=0,this._prev_right_touch_ts=0,this.InitTouchHandle=function(){$("#ddr_player_layer1").on("touchstart",(function(_){if(0!=e._is_playing){for(var t=window.innerWidth/4,a=[],i=0;i<_.originalEvent.touches.length;i++)for(var s=1;s<=4;s++)if(_.originalEvent.touches[i].pageX<t*s){switch(s){case 1:Date.now()-e._prev_left_touch_ts>100&&a.push(ARROW.LEFT),e._prev_left_touch_ts=Date.now();break;case 2:Date.now()-e._prev_down_touch_ts>100&&a.push(ARROW.DOWN),e._prev_down_touch_ts=Date.now();break;case 3:Date.now()-e._prev_up_touch_ts>100&&a.push(ARROW.UP),e._prev_up_touch_ts=Date.now();break;case 4:Date.now()-e._prev_right_touch_ts>100&&a.push(ARROW.RIGHT),e._prev_right_touch_ts=Date.now()}break}e._touch_count+=a.length,1==a.length?e.DDR_Record(a[0]):2==a.length&&(e.DDR_Record(a[0]),e.DDR_Record(a[1]))}}))},this.InitComponentHandle=function(){$("#id_btn_prepend_beat").on("click",e.PrependBeat),$("#id_btn_prepend_wave").on("click",e.PrependWave),$("#id_btn_del_from").on("click",e.DeleteFrom),$("#id_btn_shift_100_plus").on("click",e.Shift100Plus),$("#id_btn_shift_100_minus").on("click",e.Shift100Minus),$("#id_btn_shift_10_plus").on("click",e.Shift10Plus),$("#id_btn_shift_10_minus").on("click",e.Shift10Minus),$("#id_btn_clear").on("click",e.ClearNoteList)},this.SetVideoID=function(_){e._video_id=_},this.YT_OnYoutubeReady=function(){console.log("YT_OnYoutubeReady")},this.YT_OnFlowEvent=function(_){_=parseInt(1e3*_),e._timelapse_youtube=_},this.YT_OnPlayerReady=function(){1==e._late_play&&(e._late_play=!1,_yt_player.Play())},this.YT_OnPlayerStateChange=function(_){console.log("is_play "+_),_?(0==e._is_jump_play&&(e._timelapse=0,e._timelapse_youtube=0),e._is_playing=!0):e._is_playing=!1},this.SetWaveNBeat=function(_){e._game_data.SetWaveNBeat(_)},this.StartRecord=function(){e._is_jump_play=!1,console.log("StartRecord"),_renderer._base_line=e._base_line,_renderer._render_mode=RENDER_MODE.RECORD,e._timelapse=0,e._timelapse_youtube=0,e._game_data._base_line=e._base_line,e._game_data.CreateGameObjects(),_yt_player.SetEventListener(e.YT_OnYoutubeReady,e.YT_OnFlowEvent,e.YT_OnPlayerReady,e.YT_OnPlayerStateChange),0==_yt_player._is_player_ready?(_yt_player.LoadVideo(e._video_id),e._late_play=!0):_yt_player.Play()},this.StartRecordWithOffset=function(_){e._is_jump_play=!0,_edit_game_control.ChangeMode("record"),_renderer._base_line=e._base_line,_renderer._render_mode=RENDER_MODE.RECORD,e._timelapse=_,e._timelapse_youtube=_,e._game_data._base_line=e._base_line,e._game_data.CreateGameObjectsWithGivenTime(_),_yt_player.SetEventListener(e.YT_OnYoutubeReady,e.YT_OnFlowEvent,e.YT_OnPlayerReady,e.YT_OnPlayerStateChange),_yt_player.SeekAndPlay(_)},this.StopRecord=function(){_yt_player.Stop(),e._is_playing=!1,e._game_data.SortBeatList(),e._game_data.SortWaveList(),e.DisplayNoteList()},this.Jump=function(_){var t=e._game_data._beat_list[_];console.log("ms "+t.t),e.StartRecordWithOffset(t.t)},this._delta=0,this._tick=0,this.Update=function(){var _=Date.now();if(e._delta=_-e._tick,e._tick=_,e._is_playing){if(e._timelapse+=e._delta,e._timelapse_youtube+=e._delta,e._timelapse>e._timelapse_youtube){var t=e._timelapse-e._timelapse_youtube;e._timelapse-=parseInt(t/10)}else if(e._timelapse<e._timelapse_youtube){t=e._timelapse_youtube-e._timelapse;e._timelapse+=parseInt(t/10)}for(var a=0;a<e._game_data._game_objs.length;a++){e._game_data._game_objs[a].Update(e._timelapse)}_renderer.Update(e._game_data._game_objs,0)}requestAnimationFrame(e.Update)},this.AdjustBeat=function(_,t){var a=0;switch(t){case 0:a=-100;break;case 1:a=100;break;case 2:a=-10;break;case 3:a=10}var i=e._game_data._beat_list[_].t,s=e._game_data._beat_list[_].t+a;e._game_data._beat_list[_].t=s,e.DisplayNoteList(),0==e._is_playing&&(e._game_data.UpdateGameObjectOffset(i,s,e._timelapse),_renderer.Update(e._game_data._game_objs))},this.AdjustWave=function(_,t){console.log("idx "+_+" "+t);var a=0;switch(t){case 0:a=-100;break;case 1:a=100;break;case 2:a=-10;break;case 3:a=10}var i=e._game_data._wave_list[_],s=e._game_data._wave_list[_]+a;e._game_data._wave_list[_]=s,e.DisplayNoteList(),0==e._is_playing&&(e._game_data.UpdateGameObjectOffset(i,s,e._timelapse),_renderer.Update(e._game_data._game_objs))},this.GetRandomKey=function(){var e=4*Math.random()+37;return parseInt(e)},this.DDR_RecordRandom=function(_,t){if(1==_){var a=e.GetRandomKey();e.DDR_Record(parseInt(a),t)}else if(2==_){a=parseInt(4*Math.random()+0);switch(console.log("r "+a),a){case 0:e.DDR_Record(ARROW.LEFT,t),e.DDR_Record(ARROW.UP,t);break;case 1:e.DDR_Record(ARROW.LEFT,t),e.DDR_Record(ARROW.RIGHT,t);break;case 2:e.DDR_Record(ARROW.DOWN,t),e.DDR_Record(ARROW.UP,t);break;case 3:e.DDR_Record(ARROW.DOWN,t),e.DDR_Record(ARROW.RIGHT,t)}}},this.DDR_Record=function(_,t){if(0!=e._is_playing){var a=null;if(0==e._game_data._beat_list.length){var i=0;i|=_==ARROW.LEFT?LEFT_BIT:0,i|=_==ARROW.UP?UP_BIT:0,i|=_==ARROW.RIGHT?RIGHT_BIT:0,a={t:t,m:i|=_==ARROW.DOWN?DOWN_BIT:0},e._game_data.AddBall(a)}else{if(a=e._game_data._beat_list[e._game_data._beat_list.length-1],Math.abs(a.t-t)<100)_==ARROW.LEFT?a.m|=LEFT_BIT:_==ARROW.UP?a.m|=UP_BIT:_==ARROW.RIGHT?a.m|=RIGHT_BIT:_==ARROW.DOWN&&(a.m|=DOWN_BIT),e._game_data.UpdateGameObject(a);else{i=0;i|=_==ARROW.LEFT?LEFT_BIT:0,i|=_==ARROW.UP?UP_BIT:0,i|=_==ARROW.RIGHT?RIGHT_BIT:0,a={t:t,m:i|=_==ARROW.DOWN?DOWN_BIT:0},e._game_data.AddBall(a)}}}},this.Dash_Record=function(_,t){switch(_){case 96:e._game_data.AddWave(t);break;case 97:case 98:case 99:case 100:case 101:case 102:var a={t:t,n:_-96};e._game_data.AddBall(a)}},this.DeleteWave=function(_){e._game_data.DeleteWave(_),e.DisplayNoteList(),0==e._is_playing&&_renderer.Update(e._game_data._game_objs)},this.DeleteBeat=function(_){_==e._selected_note_idx&&(e._selected_note_idx=-1),e._game_data.DeleteBeat(_),e.DisplayNoteList(),0==e._is_playing&&_renderer.Update(e._game_data._game_objs)},this.ms_2_min_sec_str=function(e){var _=parseInt(e/1e3),t=parseInt(_/60),a=_%60,i="";return i+=t<10?"0"+t+":":t+":",i+=a<10?"0"+a:a,i+="."+e%1e3},this.ms_2_sec_str=function(e){var _="";return _+=parseInt(e/1e3)%60,_+="."+e%1e3},this._temp_note_and_wave_merged_list=[],this.MergeNoteListAndWaveList=function(){e._temp_note_and_wave_merged_list=[];for(var _=0;_<e._game_data._beat_list.length;_++)e._temp_note_and_wave_merged_list.push({type:"note",time:e._game_data._beat_list[_].t,org_idx:_});for(var t=0;t<e._game_data._wave_list.length;t++)for(var a=e._game_data._wave_list[t],i=0;i<e._temp_note_and_wave_merged_list.length;i++){if("note"==e._temp_note_and_wave_merged_list[i].type)if(a<=e._temp_note_and_wave_merged_list[i].time){e._temp_note_and_wave_merged_list.splice(i,0,{type:"wave",time:e._game_data._wave_list[t],org_idx:t});break}}for(i=0;i<e._temp_note_and_wave_merged_list.length;i++)e._temp_note_and_wave_merged_list[i]},this.DisplayNoteList=function(){e.MergeNoteListAndWaveList();var _=$("#id_div_record");_.empty();var t="";t+='<table class="table table-sm table-dark" id="id_table">',t+="\t<thead>",t+="\t\t<tr>",t+="\t\t\t<td>Order</td>",t+="\t\t\t<td>Time</td>",t+="\t\t\t<td>Diff</td>",e._game_type==GAME_TYPE.DDR?(t+='\t\t\t<td><i class="fas fa-arrow-left"></i></td>',t+='\t\t\t<td><i class="fas fa-arrow-down"></i></td>',t+='\t\t\t<td><i class="fas fa-arrow-up"></i></td>',t+='\t\t\t<td><i class="fas fa-arrow-right"></i></td>'):t+="\t\t\t<td></td>",t+="\t\t\t<td>0.1</td>",t+="\t\t\t<td>0.01</td>",t+="\t\t\t<td>Del</td>",t+="\t\t</tr>",t+="\t</thead>";for(var a=e._temp_note_and_wave_merged_list.length-1;a>=0;a--)"note"==e._temp_note_and_wave_merged_list[a].type?t+=e.GetRowString(e._temp_note_and_wave_merged_list[a].org_idx):"wave"==e._temp_note_and_wave_merged_list[a].type&&(t+=e.GetWaveRowString(e._temp_note_and_wave_merged_list[a].org_idx));t+="</table>",_.html(t)},this.GetWaveRowString=function(_){return txt="",txt+="<tr>",txt+="\t<td>Wave "+_+"</td>",txt+="\t<td>"+e.ms_2_min_sec_str(e._game_data._wave_list[_])+"</td>",txt+="\t<td></td>",txt+="\t<td></td>",txt+="\t<td>",txt+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.AdjustWave('+_+', 0)">-</div>',txt+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.AdjustWave('+_+', 1)">+</div>',txt+="\t</td>",txt+="\t<td>",txt+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.AdjustWave('+_+', 2)">-</div>',txt+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.AdjustWave('+_+', 3)">+</div>',txt+="\t</td>",txt+="\t<td>",txt+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.DeleteWave('+_+')">X</div>',txt+="\t</td>",txt+="</tr>",txt},this.GetRowString=function(_){var t=0;_>0&&(t=e._game_data._beat_list[_].t-e._game_data._beat_list[_-1].t);var a=new Number(_)+1,i="";if(i+="<tr>",e._selected_note_idx==_?i+='\t<td id="id_note_'+_+'" class="note_order note_selected" onclick="_game_maker.OnNoteClick('+_+')">'+a+"</td>":i+='\t<td id="id_note_'+_+'" class="note_order" onclick="_game_maker.OnNoteClick('+_+')">'+a+"</td>",i+='\t<td style="cursor:pointer" onclick="_game_maker.Jump('+_+')">'+e.ms_2_min_sec_str(e._game_data._beat_list[_].t)+"</td>",i+="\t<td>"+e.ms_2_sec_str(t)+"</td>",e._game_type==GAME_TYPE.DDR){var s="",o="",n="",l="";e._game_data._beat_list[_].m&LEFT_BIT&&(s='<i class="fas fa-arrow-left"></i>'),e._game_data._beat_list[_].m&DOWN_BIT&&(o='<i class="fas fa-arrow-down"></i>'),e._game_data._beat_list[_].m&UP_BIT&&(n='<i class="fas fa-arrow-up"></i>'),e._game_data._beat_list[_].m&RIGHT_BIT&&(l='<i class="fas fa-arrow-right"></i>'),i+='\t<td id="id_'+_+'_l" style="cursor:pointer" onclick="_game_maker.AddOrRemoveBall('+_+',1)">'+s+"</td>",i+='\t<td id="id_'+_+'_d" style="cursor:pointer" onclick="_game_maker.AddOrRemoveBall('+_+',2)">'+o+"</td>",i+='\t<td id="id_'+_+'_u" style="cursor:pointer" onclick="_game_maker.AddOrRemoveBall('+_+',3)">'+n+"</td>",i+='\t<td id="id_'+_+'_r" style="cursor:pointer" onclick="_game_maker.AddOrRemoveBall('+_+',4)">'+l+"</td>"}else i+='\t<td id="id_'+_+'_l">'+e._game_data._beat_list[_].n+"</td>";return i+="\t<td>",i+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.AdjustBeat('+_+', 0)">-</div>',i+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.AdjustBeat('+_+', 1)">+</div>',i+="\t</td>",i+="\t<td>",i+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.AdjustBeat('+_+', 2)">-</div>',i+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.AdjustBeat('+_+', 3)">+</div>',i+="\t</td>",i+="\t<td>",i+='\t\t<div class="badge badge-success" style="cursor:pointer" onclick="_game_maker.DeleteBeat('+_+')">X</div>',i+="\t</td>",i+="</tr>"},this.OnNoteClick=function(_){_==e._selected_note_idx?$("#id_note_"+_).removeClass("note_selected"):($("#id_note_"+e._selected_note_idx).removeClass("note_selected"),$("#id_note_"+_).addClass("note_selected")),e._selected_note_idx=_,$("#id_selected_idx").text(e._selected_note_idx+1)},this.AddOrRemoveBall=function(_,t){e._game_data.AddOrRemoveBall(_,t),e.DisplayNoteListUpdatedKey(_),0==e._is_playing&&_renderer.Update(e._game_data._game_objs,0)},this.DisplayNoteListAddedKey=function(_){var t=$("#id_table"),a=$(e.GetRowString(_));t.prepend(a)},this.DisplayNoteListUpdatedKey=function(_){var t="",a="",i="",s="";e._game_data._beat_list[_].m&LEFT_BIT&&(t='<i class="fas fa-arrow-left"></i>'),e._game_data._beat_list[_].m&DOWN_BIT&&(a='<i class="fas fa-arrow-down"></i>'),e._game_data._beat_list[_].m&UP_BIT&&(i='<i class="fas fa-arrow-up"></i>'),e._game_data._beat_list[_].m&RIGHT_BIT&&(s='<i class="fas fa-arrow-right"></i>'),$("#id_"+_+"_l").html(t),$("#id_"+_+"_d").html(a),$("#id_"+_+"_u").html(i),$("#id_"+_+"_r").html(s)},this.PrependBeat=function(){-1!=e._selected_note_idx?(e._game_data.PrependBeat(e._selected_note_idx),e.DisplayNoteList()):alert("Select ID")},this.PrependWave=function(){-1!=e._selected_note_idx?(e._game_data.PrependWave(e._selected_note_idx),e.DisplayNoteList()):alert("Select ID")},this.DeleteFrom=function(){-1!=e._selected_note_idx?(e._game_data.DeleteFrom(e._selected_note_idx),e._selected_note_idx=-1,e.DisplayNoteList()):alert("Select ID")},this.ClearNoteList=function(){e._game_data.ClearNoteList(),e._selected_note_idx=-1,e.DisplayNoteList()},this.Shift100Plus=function(){e._game_data.Shift(100),e.DisplayNoteList()},this.Shift100Minus=function(){e._game_data.Shift(-100),e.DisplayNoteList()},this.Shift10Plus=function(){e._game_data.Shift(10),e.DisplayNoteList()},this.Shift10Minus=function(){e._game_data.Shift(-10),e.DisplayNoteList()}}$("document").ready((function(){})),$("document").ready((function(){window._drum_player=(new DrumPlayer).Init(),window._atlas=(new Atlas).Init(),window._yt_player=(new YoutubePlayer).Init(),window._timer=(new Timer).Init();window._game_control=new GameControl(400,700).Init(),window._renderer=new Renderer(400,700,400,700).Init(),window._game_maker=(new GameMaker).Init(),window._edit_game_control=(new EditGameControl).Init()}));const EDIT_MODE={NEW:0,UPDATE:1};function EditGameControl(){var e=this;this._mode=EDIT_MODE.NEW,this._game_id="",this._video_id="",this._sound_key_list=[DEFAULT_SOUND_KEY,DEFAULT_SOUND_KEY,DEFAULT_SOUND_KEY,DEFAULT_SOUND_KEY],this.Init=function(){if(e.InitLayout(),_drum_player._onLoadingFinishedCallback=e.LoadDrumFinished,e._game_id=GetURLParam("id"),console.log("self._game_id "+e._game_id),null==e._game_id){e.ChangeEditMode(EDIT_MODE.NEW),e.LoadDrumList(),e.LoadInitDrums();var _=GetURLParam("v");null!=_&&(e._video_id=_,_yt_player._video_id=e._video_id,$("#id_text_video").val(e._video_id))}else e.ChangeEditMode(EDIT_MODE.UPDATE),e.GetGameData((function(_){e._video_id=_.video_id,_yt_player._video_id=e._video_id,e._sound_key_list=JSON.parse(_.sound_key_list),$("#id_text_artist").val(_.artist),$("#id_text_title").val(_.title),console.log("game_data.difficulty "+_.difficulty),0==_.difficulty?$("#id_easy").prop("checked",!0):1==_.difficulty?$("#id_normal").prop("checked",!0):2==_.difficulty&&$("#id_hard").prop("checked",!0),$("#id_text_video").val(e._video_id),$("#id_text_created_time").html(_.timestamp_created),$("#id_text_modified_time").html(_.timestamp_modified),e.LoadDrumList(),e.LoadInitDrums();var t=JSON.parse(_._wave_n_beat);e.ApplyBallList(t)}));return e.InitComponentHandle(),this},this.ApplyBallList=function(_){e.DisplayBeginOffset(_),_game_maker.SetWaveNBeat(_),_game_maker.DisplayNodeList(),_game_control.SetWaveNBeat(_),_game_control.PrepareGame()},this.DisplayBeginOffset=function(e){e.length>0&&$("#id_txt_offset").html(e[0].t)},this.InitLayout=function(){e._ddr_player_height=window.innerHeight-120,$("#player").css("height","120px"),$("#ddr_player").css("height",e._ddr_player_height+"px"),$("#rank_layer").css("height",e._ddr_player_height+"px"),e.ChangeLayout(LAYOUT.INFO)},this.InitComponentHandle=function(){$("#id_btn_back").on("click",(function(){window.history.back()})),$("#id_text_video").on("change",e.LoadVideo),$("#id_btn_save_game").on("click",e.SaveGame),$("#id_btn_update_game").on("click",e.UpdateGame),$("#id_btn_delete").on("click",e.DeleteGame),$("#id_btn_play").on("click",e.PlayGame),$("#id_btn_pause").on("click",e.PauseGame),$("#id_btn_stop").on("click",e.StopGame),$("#id_btn_start_record").on("click",e.StartRecord),$("#id_btn_stop_record").on("click",e.StopRecord),$("#id_btn_clear_record").on("click",e.ClearRecord),$("#id_sel_sound-0").on("change",e.LoadDrum),$("#id_sel_sound-1").on("change",e.LoadDrum),$("#id_sel_sound-2").on("change",e.LoadDrum),$("#id_sel_sound-3").on("change",e.LoadDrum),$("#id_btn_drum_test-0").on("mousedown",(function(){_drum_player.Hit(ARROW.LEFT)})),$("#id_btn_drum_test-1").on("mousedown",(function(){_drum_player.Hit(ARROW.DOWN)})),$("#id_btn_drum_test-2").on("mousedown",(function(){_drum_player.Hit(ARROW.UP)})),$("#id_btn_drum_test-3").on("mousedown",(function(){_drum_player.Hit(ARROW.RIGHT)})),$("#id_btn_adjust_minus").on("click",e.AdjustMinus),$("#id_btn_adjust_plus").on("click",e.AdjustPlus)},this.AdjustMinus=function(){for(var _=_game_maker._game_data._ball_list,t=0;t<_.length;t++)_[t].t-=100;e.ApplyBallList(_)},this.AdjustPlus=function(){for(var _=_game_maker._game_data._ball_list,t=0;t<_.length;t++)_[t].t+=100;e.ApplyBallList(_)},this.ChangeLayout=function(e){switch(e){case LAYOUT.INFO:$("#info_layer").css("visibility","visible"),$("#play_layer").css("visibility","hidden"),$("#record_layer").css("visibility","hidden");break;case LAYOUT.PLAY:$("#info_layer").css("visibility","hidden"),$("#play_layer").css("visibility","visible"),$("#record_layer").css("visibility","hidden");break;case LAYOUT.RECORD:$("#info_layer").css("visibility","hidden"),$("#play_layer").css("visibility","hidden"),$("#record_layer").css("visibility","visible")}},this.ChangeEditMode=function(e){e==EDIT_MODE.NEW?($("#id_btn_save_game").css("display",""),$("#id_btn_update_game").css("display","none"),$("#id_btn_delete").css("display","none")):e==EDIT_MODE.UPDATE&&($("#id_btn_save_game").css("display","none"),$("#id_btn_update_game").css("display",""),$("#id_btn_delete").css("display",""))},this.GetGameData=function(_){var t={game_id:e._game_id};$.ajax({url:"/beat_api/get_game_data",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.ok?_&&_(e.game_data):alert(e.err)}})},this.LoadInitDrums=function(){_drum_player.LoadDrum(0,e._sound_key_list[0]),_drum_player.LoadDrum(1,e._sound_key_list[1]),_drum_player.LoadDrum(2,e._sound_key_list[2]),_drum_player.LoadDrum(3,e._sound_key_list[3])},this.LoadDrumList=function(){for(var _=$("#id_sel_sound-0"),t=$("#id_sel_sound-1"),a=$("#id_sel_sound-2"),i=$("#id_sel_sound-3"),s=0;s<DRUMS.length;s++){var o="";e._sound_key_list[0]==DRUMS[s].file&&(o="selected"),_.append("<option "+o+">"+DRUMS[s].name+"</option>")}for(s=0;s<DRUMS.length;s++){o="";e._sound_key_list[1]==DRUMS[s].file&&(o="selected"),t.append("<option "+o+">"+DRUMS[s].name+"</option>")}for(s=0;s<DRUMS.length;s++){o="";e._sound_key_list[2]==DRUMS[s].file&&(o="selected"),a.append("<option "+o+">"+DRUMS[s].name+"</option>")}for(s=0;s<DRUMS.length;s++){o="";e._sound_key_list[3]==DRUMS[s].file&&(o="selected"),i.append("<option "+o+">"+DRUMS[s].name+"</option>")}},this._loading_drum_idx=0,this.LoadDrum=function(){var _=this.id.split("-")[1];e._loading_drum_idx=_,$("#id_text_drum_loading-"+_).html("loading");var t=DRUM_GetDrumKeyByName(this.value);e._sound_key_list[_]=t,_drum_player.LoadDrum(_,t)},this.LoadDrumFinished=function(){$("#id_text_drum_loading-"+e._loading_drum_idx).html("")},this.LoadVideo=function(){var _=$("#id_text_video").val();e._video_id=GetVideoIDFromURL(_),""!=e._video_id&&(_game_maker.SetVideoID(e._video_id),_game_control.SetVideoID(e._video_id),_yt_player.LoadVideo(e._video_id))},this.ValidateAndGetGameData=function(){if(""==e._video_id)return alert("Please input youtube video url"),!1;var _=$("#id_text_artist");if(_.val(_.val().trim()),""==_.val())return alert("Please input artist."),!1;var t=$("#id_text_title");if(t.val(t.val().trim()),""==t.val())return alert("Please input title"),!1;var a=0;return $("#id_easy").prop("checked")?a=0:$("#id_normal").prop("checked")?a=1:$("#id_hard").prop("checked")&&(a=2),{video_id:e._video_id,artist:_.val(),title:t.val(),difficulty:a,sound_key_list:e._sound_key_list,ball_list:_game_maker._game_data._ball_list}},this.SaveGame=function(){var _=e.ValidateAndGetGameData();0!=_&&$.ajax({url:"/beat_api/register",type:"POST",data:JSON.stringify(_),contentType:"application/json; charset=utf-8",dataType:"json",success:function(_){_.ok?(e._game_id=_.game_id,$("#id_text_created_time").html(_.timestamp.timestamp_created),$("#id_text_modified_time").html(_.timestamp.timestamp_modified),e.ChangeEditMode(EDIT_MODE.UPDATE),alert("Saved Successfully")):alert(_.err)}})},this.UpdateGame=function(){var _=e.ValidateAndGetGameData();0!=_&&(_.game_id=e._game_id,$.ajax({url:"/beat_api/update",type:"POST",data:JSON.stringify(_),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.ok?($("#id_text_created_time").html(e.timestamp.timestamp_created),$("#id_text_modified_time").html(e.timestamp.timestamp_modified),alert("Updated Successfully")):alert(e.err)}}))},this.DeleteGame=function(){if(0!=confirm("Delete Game?")){var _={game_id:e._game_id};$.ajax({url:"/beat_api/delete_game",type:"POST",data:JSON.stringify(_),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.ok?(alert("Deleted Successfully"),window.location.href="/"):alert(e.err)}})}},this.PlayGame=function(){null!=e._video_id&&""!=e._video_id?(e.ChangeLayout(LAYOUT.PLAY),_game_control.PlayGame()):alert("Please input youtube URL")},this.PauseGame=function(){_game_control.PauseGame()},this.StopGame=function(){e.ChangeLayout(LAYOUT.INFO),_game_control.StopGame(),_game_control.PrepareGame()},this.StartRecord=function(){null!=e._video_id&&""!=e._video_id?(e.ChangeLayout(LAYOUT.RECORD),_game_maker.StartRecord()):alert("Please input youtube URL")},this.StopRecord=function(){e.ChangeLayout(LAYOUT.INFO),_game_maker.StopRecord(),_game_control.SetWaveNBeat(_game_maker._game_data._wave_n_beat),_game_control.PrepareGame()},this.ClearRecord=function(){_game_maker.ClearRecord()}}