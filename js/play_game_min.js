const DRUMS=[{name:"Bass Drum 2",file:"12835_0_Chaos_sf2_file.js",var:"_drum_35_0_Chaos_sf2_file",pitch:35},{name:"Bass Drum 1",file:"12836_0_Chaos_sf2_file.js",var:"_drum_36_0_Chaos_sf2_file",pitch:36},{name:"Side Stick/Rimshot",file:"12837_0_Chaos_sf2_file.js",var:"_drum_37_0_Chaos_sf2_file",pitch:37},{name:"Snare Drum 1",file:"12838_0_Chaos_sf2_file.js",var:"_drum_38_0_Chaos_sf2_file",pitch:38},{name:"Hand Clap",file:"12839_0_Chaos_sf2_file.js",var:"_drum_39_0_Chaos_sf2_file",pitch:39},{name:"Snare Drum 2",file:"12840_0_Chaos_sf2_file.js",var:"_drum_40_0_Chaos_sf2_file",pitch:40},{name:"Low Tom 2",file:"12841_0_Chaos_sf2_file.js",var:"_drum_41_0_Chaos_sf2_file",pitch:41},{name:"Closed Hi-hat",file:"12842_0_Chaos_sf2_file.js",var:"_drum_42_0_Chaos_sf2_file",pitch:42},{name:"Low Tom 1",file:"12843_0_Chaos_sf2_file.js",var:"_drum_43_0_Chaos_sf2_file",pitch:43},{name:"Pedal Hi-hat",file:"12844_0_Chaos_sf2_file.js",var:"_drum_44_0_Chaos_sf2_file",pitch:44},{name:"Mid Tom 2",file:"12845_0_Chaos_sf2_file.js",var:"_drum_45_0_Chaos_sf2_file",pitch:45},{name:"Open Hi-hat",file:"12846_0_Chaos_sf2_file.js",var:"_drum_46_0_Chaos_sf2_file",pitch:46},{name:"Mid Tom 1",file:"12847_0_Chaos_sf2_file.js",var:"_drum_47_0_Chaos_sf2_file",pitch:47},{name:"High Tom 2",file:"12848_0_Chaos_sf2_file.js",var:"_drum_48_0_Chaos_sf2_file",pitch:48},{name:"Crash Cymbal 1",file:"12849_0_Chaos_sf2_file.js",var:"_drum_49_0_Chaos_sf2_file",pitch:49},{name:"High Tom 1",file:"12850_0_Chaos_sf2_file.js",var:"_drum_50_0_Chaos_sf2_file",pitch:50},{name:"Ride Cymbal 1",file:"12851_0_Chaos_sf2_file.js",var:"_drum_51_0_Chaos_sf2_file",pitch:51},{name:"Chinese Cymbal",file:"12852_0_Chaos_sf2_file.js",var:"_drum_52_0_Chaos_sf2_file",pitch:52},{name:"Ride Bell",file:"12853_0_Chaos_sf2_file.js",var:"_drum_53_0_Chaos_sf2_file",pitch:53},{name:"Tambourine",file:"12854_0_Chaos_sf2_file.js",var:"_drum_54_0_Chaos_sf2_file",pitch:54},{name:"Splash Cymbal",file:"12855_0_Chaos_sf2_file.js",var:"_drum_55_0_Chaos_sf2_file",pitch:55},{name:"Cowbell",file:"12856_0_Chaos_sf2_file.js",var:"_drum_56_0_Chaos_sf2_file",pitch:56},{name:"Crash Cymbal 2",file:"12857_0_Chaos_sf2_file.js",var:"_drum_57_0_Chaos_sf2_file",pitch:57},{name:"Vibra Slap",file:"12858_0_Chaos_sf2_file.js",var:"_drum_58_0_Chaos_sf2_file",pitch:58},{name:"Ride Cymbal 2",file:"12859_0_Chaos_sf2_file.js",var:"_drum_59_0_Chaos_sf2_file",pitch:59},{name:"High Bongo",file:"12860_0_Chaos_sf2_file.js",var:"_drum_60_0_Chaos_sf2_file",pitch:60},{name:"Low Bongo",file:"12861_0_Chaos_sf2_file.js",var:"_drum_61_0_Chaos_sf2_file",pitch:61},{name:"Mute High Conga",file:"12862_0_Chaos_sf2_file.js",var:"_drum_62_0_Chaos_sf2_file",pitch:62},{name:"Open High Conga",file:"12863_0_Chaos_sf2_file.js",var:"_drum_63_0_Chaos_sf2_file",pitch:63},{name:"Low Conga",file:"12864_0_Chaos_sf2_file.js",var:"_drum_64_0_Chaos_sf2_file",pitch:64},{name:"High Timbale",file:"12865_0_Chaos_sf2_file.js",var:"_drum_65_0_Chaos_sf2_file",pitch:65},{name:"Low Timbale",file:"12866_0_Chaos_sf2_file.js",var:"_drum_66_0_Chaos_sf2_file",pitch:66},{name:"High Agogo",file:"12867_0_Chaos_sf2_file.js",var:"_drum_67_0_Chaos_sf2_file",pitch:67},{name:"Low Agogo",file:"12868_0_Chaos_sf2_file.js",var:"_drum_68_0_Chaos_sf2_file",pitch:68},{name:"Cabasa",file:"12869_0_Chaos_sf2_file.js",var:"_drum_69_0_Chaos_sf2_file",pitch:69},{name:"Maracas",file:"12870_0_Chaos_sf2_file.js",var:"_drum_70_0_Chaos_sf2_file",pitch:70},{name:"Short Whistle",file:"12871_0_Chaos_sf2_file.js",var:"_drum_71_0_Chaos_sf2_file",pitch:71},{name:"Long Whistle",file:"12872_0_Chaos_sf2_file.js",var:"_drum_72_0_Chaos_sf2_file",pitch:72},{name:"Short Guiro",file:"12873_0_Chaos_sf2_file.js",var:"_drum_73_0_Chaos_sf2_file",pitch:73},{name:"Long Guiro",file:"12874_0_Chaos_sf2_file.js",var:"_drum_74_0_Chaos_sf2_file",pitch:74},{name:"Claves",file:"12875_0_Chaos_sf2_file.js",var:"_drum_75_0_Chaos_sf2_file",pitch:75},{name:"High Wood Block",file:"12876_0_Chaos_sf2_file.js",var:"_drum_76_0_Chaos_sf2_file",pitch:76},{name:"Low Wood Block",file:"12877_0_Chaos_sf2_file.js",var:"_drum_77_0_Chaos_sf2_file",pitch:77},{name:"Mute Cuica",file:"12878_0_Chaos_sf2_file.js",var:"_drum_78_0_Chaos_sf2_file",pitch:78},{name:"Open Cuica",file:"12879_0_Chaos_sf2_file.js",var:"_drum_79_0_Chaos_sf2_file",pitch:79},{name:"Mute Triangle",file:"12880_0_Chaos_sf2_file.js",var:"_drum_80_0_Chaos_sf2_file",pitch:80},{name:"Open Triangle",file:"12881_0_Chaos_sf2_file.js",var:"_drum_81_0_Chaos_sf2_file",pitch:81}];function DRUM_GetDrumName(_){for(var e=0;e<DRUMS.length;e++)if(DRUMS[e].file==_)return DRUMS[e].name;return""}function DRUM_GetVariable(_){for(var e=0;e<DRUMS.length;e++)if(DRUMS[e].file==_)return DRUMS[e].var;return""}function DRUM_GetPitch(_){for(var e=0;e<DRUMS.length;e++)if(DRUMS[e].file==_)return DRUMS[e].pitch;return""}function DRUM_GetDrumKeyByName(_){var e=_;"Snare (hit)"==_?e="Snare Drum 1":"Snare (side stick)"==_?e="Snare Drum 2":"Hi-Hat (closed)"==_?e="Closed Hi-hat":"Kick (hit)"==_?e="Bass Drum 2":"Hi-Hat (open)"==_?e="Open Hi-hat":"Pedal Hi-Hat (hit)"==_?e="Pedal Hi-hat":"Crash high (hit)"==_?e="Crash Cymbal 1":"Crash medium (hit)"==_?e="Crash Cymbal 2":"Splash (hit)"==_?e="Splash Cymbal":"Low Tom (hit)"==_?e="Low Tom 1":"Very Low Tom (hit)"==_?e="Low Tom 2":"Hand Clap (hit)"==_?e="Hand Clap":"Castanets (hit)"==_&&(e="Hand Clap");for(var t=0;t<DRUMS.length;t++)if(DRUMS[t].name==e)return DRUMS[t].file;return null}function DrumPlayer(){var self=this;this._audioContext=null,this._player=null,this._onLoadingFinishedCallback=null,this._drum_info_list=[{file:"",var:"",pitch:0},{file:"",var:"",pitch:0},{file:"",var:"",pitch:0},{file:"",var:"",pitch:0}],this.Init=function(){var _=window.AudioContext||window.webkitAudioContext;return self._audioContext=new _,self._player=new WebAudioFontPlayer,self.LoadDefaultDrum(),this},this.LoadDefaultDrum=function(){for(var _={file:"",var:"",pitch:0},e=DEFAULT_SOUND_KEY,t=0;t<DRUMS.length;t++)if(DRUMS[t].file==DEFAULT_SOUND_KEY){_.file=e,_.var=DRUMS[t].var,_.pitch=DRUMS[t].pitch;break}for(t=0;t<self._drum_info_list.length;t++)self._drum_info_list[t]=_;var i="lib/webaudiofontdata/sound/"+e;self._player.loader.startLoad(self._audioContext,i,_.var),self._player.loader.waitLoad((function(){console.log("Default Drum Loading Finished")}))},this.LoadDrum=function(_,e){for(var t={file:"",var:"",pitch:0},i=0;i<DRUMS.length;i++)if(DRUMS[i].file==e){t.file=e,t.var=DRUMS[i].var,t.pitch=DRUMS[i].pitch;break}self._drum_info_list[_]=t;var a="lib/webaudiofontdata/sound/"+e;self._player.loader.startLoad(self._audioContext,a,t.var),self._player.loader.waitLoad((function(){console.log("Drum Loading Finished"),null!=self._onLoadingFinishedCallback&&self._onLoadingFinishedCallback()}))},this.Hit=function(arrow){var idx=0;switch(arrow){case ARROW.LEFT:idx=0;break;case ARROW.DOWN:idx=1;break;case ARROW.UP:idx=2;break;case ARROW.RIGHT:idx=3}self._player.queueWaveTable(self._audioContext,self._audioContext.destination,eval(self._drum_info_list[idx].var),0,self._drum_info_list[idx].pitch,.2,.1)}}function Atlas(){var _=this;this._img=null,this._img_l=null,this._img_d=null,this._img_u=null,this._img_r=null,this._img_l_hit=null,this._img_d_hit=null,this._img_u_hit=null,this._img_r_hit=null,this._img_l_empty=null,this._img_d_empty=null,this._img_u_empty=null,this._img_r_empty=null,this.Init=function(){return _._img=new Image,_._img.src="img/atlas.png",_.LoadSprite(),this},this.LoadSprite=function(){var e=50;_._img_l={x:0,y:0,w:e,h:e},_._img_d={x:e,y:0,w:e,h:e},_._img_u={x:100,y:0,w:e,h:e},_._img_r={x:150,y:0,w:e,h:e},_._img_l_hit={x:0,y:e,w:e,h:e},_._img_d_hit={x:e,y:e,w:e,h:e},_._img_u_hit={x:100,y:e,w:e,h:e},_._img_r_hit={x:150,y:e,w:e,h:e},_._img_l_empty={x:0,y:100,w:e,h:e},_._img_d_empty={x:e,y:100,w:e,h:e},_._img_u_empty={x:100,y:100,w:e,h:e},_._img_r_empty={x:150,y:100,w:e,h:e}}}const ARROW={LEFT:37,UP:38,RIGHT:39,DOWN:40},DIMENSION={_2D:0,_3D:1},LEFT_BIT=1,UP_BIT=2,RIGHT_BIT=4,DOWN_BIT=8,DEFAULT_SOUND_KEY="12844_0_Chaos_sf2_file.js",LAYOUT={INFO:0,PLAY:1,RECORD:2},MOVE_DIRECTION={UPWARD:0,DOWNWARD:1},RENDER_MODE={PLAY:0,RECORD:1},GAME_TYPE={DDR:0,Dash:1};function GetURLParam(_){var e=new RegExp("[?&]"+_+"=([^&#]*)").exec(window.location.href);return null==e?null:decodeURI(e[1])||0}function ConvertSecondsForDiaplsy(_){var e=_%60;return parseInt(_/60)+":"+(e<10?"0"+e:e)}function GetVideoIDFromURL(_){var e="";if(_.startsWith("https://www.youtube.com/watch?"))for(var t=_.split("?")[1].split("&"),i=0;t.length;i++){var a=t[i].split("=")[0],s=t[i].split("=")[1];if("v"==a){e=s;break}}else if(_.startsWith("https://youtu.be/")){e=_.substring("https://youtu.be/".length)}else e=_;return e}function Timer(){var _=this;this._tick=null,this._delta=0,this.Init=function(){return _._tick=Date.now(),_.Update(),this},this.Update=function(){var e=Date.now();_._delta=e-_._tick,_._tick=e,requestAnimationFrame(_.Update)}}function onYouTubeIframeAPIReady(){console.log("onYouTubeIframeAPIReady"),_yt_player.Ready()}function YoutubePlayer(){var _=this;this._is_player_ready=!1,this._player=null,this._video_id=null,this._is_flow_controlling=!1,this._timer=null,this._is_playing=!1,this._cb_on_youtube_ready=null,this._cb_on_flow_event=null,this._cb_on_player_ready=null,this._cb_on_player_state_changed=null,this.Init=function(){console.log("YoutubePlayer Init");var _=document.createElement("script");_.src="https://www.youtube.com/iframe_api";var e=document.getElementsByTagName("script")[0];return e.parentNode.insertBefore(_,e),this},this.SetEventListener=function(e,t,i,a){console.log("SetEventListener"),_._cb_on_youtube_ready=e,_._cb_on_flow_event=t,_._cb_on_player_ready=i,_._cb_on_player_state_changed=a},this.Ready=function(){console.log("Ready"),_._cb_on_youtube_ready&&_._cb_on_youtube_ready(),null!=_._video_id&&_.LoadVideo(_._video_id)},this.LoadVideo=function(e){if(null==_._player)_._video_id=e,_._player=new YT.Player("player",{height:"240",width:"320",videoId:_._video_id,events:{onReady:_.OnPlayerReady,onStateChange:_.OnPlayerStateChange}});else{if(_._video_id==e)return;_._video_id=e,_._player.loadVideoById(e)}},this.OnPlayerReady=function(){_._is_player_ready=!0;var e=_._player.getAvailablePlaybackRates(),t=_._player.getDuration(),i=_._player.getVolume();_._cb_on_player_ready&&_._cb_on_player_ready(e,t,i)},this.OnPlayerStateChange=function(e){switch(e.data){case YT.PlayerState.ENDED:_.FlowControlStop(),_._is_playing=!1;break;case YT.PlayerState.PLAYING:_.FlowControlStart(),_._is_playing=!0;break;case YT.PlayerState.PAUSED:case YT.PlayerState.BUFFERING:case YT.PlayerState.CUED:_.FlowControlStop(),_._is_playing=!1}_._cb_on_player_state_changed&&(console.log("self._is_playing "+_._is_playing),_._cb_on_player_state_changed(_._is_playing))},this.SeekAndPlay=function(e){_._player.cueVideoById({videoId:_._video_id,startSeconds:e/1e3}),_._player.playVideo()},this.FlowControlStart=function(){_._is_flow_controlling||(_._is_flow_controlling=!0,_._timer=setInterval(_.FlowControl,100))},this.FlowControlStop=function(){_._is_flow_controlling=!1,clearInterval(_._timer)},this.FlowControl=function(){var e=_._player.getCurrentTime();_._cb_on_flow_event&&_._cb_on_flow_event(e)},this.Play=function(){0==_._is_playing&&null!=_._player&&_._player.playVideo()},this.Stop=function(){null!=_._player&&_._player.stopVideo()},this.Pause=function(){_._is_playing&&_._player&&_._player.pauseVideo()},this.IsPlaying=function(){return _._is_playing},this.ChangeSpeed=function(e){var t=parseFloat(e);console.log(t),_._player.setPlaybackRate(parseFloat(t))},this.SetVolume=function(e){_._player.setVolume(e)},this.SetPlaybackQuality=function(){_._player.setPlaybackQuality("small")}}function Renderer(_,e,t,i){var a=this;this._canvas=null,this._ctx=null,this._base_line=600,this._debug=!1,this._score=0,this._render_mode=RENDER_MODE.RECORD,this._game_width=_,this._game_height=e,this._screen_width=t,this._screen_height=i,this._show_index_number=!1,this._progress_percent=0,this._particle_list=[],this.Init=function(){a._canvas=document.getElementById("ddr_player_layer1"),a._canvas.width=a._screen_width,a._canvas.height=a._screen_height,console.log("self._canvas "+a._canvas),a._ctx=a._canvas.getContext("2d");var _=a._screen_width/a._game_width,e=a._screen_height/a._game_height;return console.log("scale_width "+_),console.log("scale_height "+e),a._ctx.scale(_,e),a._render_mode==RENDER_MODE.PLAY?(a.DrawBaseLine(),a.DrawVerticalLine(),a.DrawEmpty(),a.DrawScore()):a._render_mode==RENDER_MODE.RECORD&&(a.DrawBaseLine(),a.DrawVerticalLine(),a.DrawEmpty()),this},this.Update=function(_,e){a._ctx.clearRect(0,0,a._game_width,a._game_height),a.DrawBaseLine(),a.DrawVerticalLine(),a._render_mode==RENDER_MODE.PLAY&&(a.DrawHit(),a.DrawProgress()),a.DrawEmpty();for(var t=a._particle_list.length-1;t>=0;t--)a._particle_list[t].IsEnd()?a._particle_list.splice(t,1):a._particle_list[t].Update();a.DrawObjs(_,e),a._render_mode==RENDER_MODE.PLAY&&a.DrawScore()},this.UpdateScore=function(_){a._score=_},this.UpdateProgress=function(_){a._progress_percent=_},this.DrawProgress=function(){var _=a._game_width*a._progress_percent;a.DrawLineWidth(0,0,_,0,"red",20)},this.DrawObjs=function(_,e){for(var t=e;t<_.length;t++){var i=_[t];if(!i._is_hit&&!i._passed&&(!(i._y<-100||i._y>700)&&(a.DrawLine(0,i._y+i._h/2,a._game_width,i._y+i._h/2,"#aaa"),a._ctx.drawImage(_atlas._img,i._img.x,i._img.y,i._img.w,i._img.h,i._x,i._y,i._w,i._h),a._show_index_number))){var s=i._x+i._w/2,o=i._y+i._h/2;a.DrawText(i._order+1,s,o,25)}}},this.DrawBaseLine=function(){a._render_mode==RENDER_MODE.PLAY?(a._debug&&(a.DrawLine(0,100,a._game_width,100,"#aaa"),a.DrawLine(0,200,a._game_width,200,"#aaa"),a.DrawLine(0,300,a._game_width,300,"#aaa"),a.DrawLine(0,400,a._game_width,400,"#aaa"),a.DrawLine(0,500,a._game_width,500,"#aaa")),a.DrawLine(0,a._base_line,a._game_width,a._base_line,"RED")):a._render_mode==RENDER_MODE.RECORD&&(a._debug&&(a.DrawLine(0,200,a._game_width,200,"#aaa"),a.DrawLine(0,300,a._game_width,300,"#aaa"),a.DrawLine(0,400,a._game_width,400,"#aaa"),a.DrawLine(0,500,a._game_width,500,"#aaa"),a.DrawLine(0,600,a._game_width,600,"#aaa")),a.DrawLine(0,a._base_line,a._game_width,a._base_line,"RED"))},this.DrawLine=function(_,e,t,i,s){a._ctx.beginPath(),a._ctx.moveTo(_,e),a._ctx.lineTo(t,i),a._ctx.lineWidth=1,a._ctx.strokeStyle=s,a._ctx.stroke()},this.DrawLineWidth=function(_,e,t,i,s,o){a._ctx.beginPath(),a._ctx.moveTo(_,e),a._ctx.lineTo(t,i),a._ctx.lineWidth=1,a._ctx.strokeStyle=s,a._ctx.lineWidth=o,a._ctx.stroke()},this.DrawVerticalLine=function(){var _=a._game_width/4;a.DrawLine(_,0,_,a._game_height,"#aaa"),a.DrawLine(2*_,0,2*_,a._game_height,"#aaa"),a.DrawLine(3*_,0,3*_,a._game_height,"#aaa")},this.DrawEmpty=function(){var _=a._game_width/4,e=_/2;a._ctx.drawImage(_atlas._img,_atlas._img_l_empty.x,_atlas._img_l_empty.y,_atlas._img_l_empty.w,_atlas._img_l_empty.h,e-32.5,a._base_line-32.5,65,65),a._ctx.drawImage(_atlas._img,_atlas._img_d_empty.x,_atlas._img_d_empty.y,_atlas._img_d_empty.w,_atlas._img_d_empty.h,e+_-32.5,a._base_line-32.5,65,65),a._ctx.drawImage(_atlas._img,_atlas._img_u_empty.x,_atlas._img_u_empty.y,_atlas._img_u_empty.w,_atlas._img_u_empty.h,e+2*_-32.5,a._base_line-32.5,65,65),a._ctx.drawImage(_atlas._img,_atlas._img_r_empty.x,_atlas._img_r_empty.y,_atlas._img_r_empty.w,_atlas._img_r_empty.h,e+3*_-32.5,a._base_line-32.5,65,65)},this._hit_left=!1,this._hit_up=!1,this._hit_right=!1,this._hit_down=!1,this._hit_step_left=0,this._hit_step_up=1,this._hit_step_right=1,this._hit_step_down=1,this._hit_left_dur=0,this._hit_up_dur=0,this._hit_right_dur=0,this._hit_down_dur=0,this._hit_result_left=null,this._hit_result_up=null,this._hit_result_right=null,this._hit_result_dopwn=null,this._hit_combo=!1,this._hit_combo_dur=0,this._hit_combo_count=0,this.Hit=function(_,e,t){var i=a._game_width/4,s=i/2;_==ARROW.LEFT&&(a._hit_left=!0,console.log("HIT LEFT "+!0),a._hit_left_dur=Date.now(),a._hit_result_left=e,a._hit_step_left=1.3,a.CreateParticles(s,a._base_line)),_==ARROW.UP&&(a._hit_up=!0,a._hit_up_dur=Date.now(),a._hit_result_up=e,a._hit_step_up=1,a.CreateParticles(2*i+s,a._base_line)),_==ARROW.RIGHT&&(a._hit_right=!0,a._hit_right_dur=Date.now(),a._hit_result_right=e,a._hit_step_right=1,a.CreateParticles(3*i+s,a._base_line)),_==ARROW.DOWN&&(a._hit_down=!0,a._hit_down_dur=Date.now(),a._hit_result_down=e,a._hit_step_down=1,a.CreateParticles(i+s,a._base_line)),t>1?(a._hit_combo=!0,a._hit_combo_dur=Date.now(),a._hit_combo_count=t):a._hit_combo=!1},this.CreateParticles=function(_,e){for(var t=0;t<30;t++){var i=new Particle(_,e).Init();i._ctx=a._ctx,a._particle_list.push(i)}},this.DrawHit=function(){a._game_width;if(a._hit_left){_atlas._img_l_hit.w,a._hit_step_left;var _=_atlas._img_l_hit.h*a._hit_step_left;a._base_line;a._hit_step_left=a._hit_step_left+.12;var e=80,t=a._base_line;a.DrawText(a._hit_result_left.text,e,t+50,26,"blue"),a.DrawText(a._hit_result_left.score,e,t+80,26,"blue"),Date.now()-a._hit_left_dur>200&&(a._hit_left=!1)}if(a._hit_down){_atlas._img_d_hit.w,a._hit_step_down,_=_atlas._img_d_hit.h*a._hit_step_down,a._base_line;a._hit_step_down=a._hit_step_down+.12;e=160,t=a._base_line;a.DrawText(a._hit_result_down.text,e,t+50,26,"blue"),a.DrawText(a._hit_result_down.score,e,t+80,26,"blue"),Date.now()-a._hit_down_dur>200&&(a._hit_down=!1)}if(a._hit_up){_atlas._img_u_hit.w,a._hit_step_up,_=_atlas._img_u_hit.h*a._hit_step_up,a._base_line;a._hit_step_up=a._hit_step_up+.12;e=240,t=a._base_line;a.DrawText(a._hit_result_up.text,e,t+50,26,"blue"),a.DrawText(a._hit_result_up.score,e,t+80,26,"blue"),Date.now()-a._hit_up_dur>200&&(a._hit_up=!1)}if(a._hit_right){_atlas._img_r_hit.w,a._hit_step_right,_=_atlas._img_r_hit.h*a._hit_step_right,a._base_line;a._hit_step_right=a._hit_step_right+.12;e=320,t=a._base_line;a.DrawText(a._hit_result_right.text,e,t+50,26,"blue"),a.DrawText(a._hit_result_right.score,e,t+80,26,"blue"),Date.now()-a._hit_right_dur>200&&(a._hit_right=!1)}},this.DrawText=function(_,e,t,i,s){var o=new Number(i);a._ctx.textBaseline="middle",a._ctx.font=o+"px Arial",a._ctx.textAlign="center",a._ctx.fillStyle=s,a._ctx.fillText(_,e,t)},this.DrawScore=function(){if(a.DrawText(a._score,200,50,50,"red"),a._hit_combo){var _=a._hit_combo_count-1+" COMBO";_+="\n +"+10*(a._hit_combo_count-1),a.DrawText(_,200,220,25,"blue")}},this.DisplayResult=function(_){_?(a.DrawText("Congraturations!",202,302,50,"White"),a.DrawText("Congraturations!",200,300,50,"Red"),a.DrawText("Your New Score",202,352,33,"White"),a.DrawText("Your New Score",200,350,33,"Red"),a.DrawText("Score "+a._score,202,402,33,"White"),a.DrawText("Score "+a._score,200,400,33,"Blue")):(a.DrawText("Oops!",202,302,50,"White"),a.DrawText("Oops!",200,300,50,"Red"))}}function Particle(_,e){var t=this;this._ctx=null,this._x=_,this._y=e,this._w=10,this._h=10,this._rotate_speed=1,this._move_x=1,this._move_y=1,this._degree=0,this._alpha=1,this._start_ms=Date.now(),this._life_ms=500,this.Init=function(){t._rotate_speed=t.Random(-30,30);var _=t.Random(10,30);return t._w=t._h=_,t._move_x=t.Random(-10,10),t._move_y=t.Random(-10,10),this},this.Random=function(_,e){return Math.random()*(e-_)+_},this.Update=function(){t._degree+=t._rotate_speed,t._x+=t._move_x,t._y+=t._move_y,t._alpha-=.03,t._alpha<0&&(t._alpha=0),t.Draw()},this.Draw=function(){var _=t._x+t._w/2,e=t._y+t._h/2;t._ctx.save(),t._ctx.translate(_,e),t._ctx.rotate(t._degree*Math.PI/180),t._ctx.translate(-_,-e),t._ctx.lineWidth=1,t._ctx.fillStyle="white",t._ctx.strokeStyle="black",t._ctx.globalAlpha=t._alpha,t._ctx.fillRect(t._x,t._y,t._w,t._h),t._ctx.strokeRect(t._x,t._y,t._w,t._h),t._ctx.restore()},this.IsEnd=function(){return Date.now()-t._start_ms>t._life_ms}}function GameData(_,e){var t=this;this._game_type=null,this._speed=150,this._base_line=100,this._beat_list=[],this._wave_list=[],this._game_objs=[],this._dimension=_,this._move_direction=e,this._note_order=0,this.Init=function(){return this},this.SetGameType=function(_){t._game_type=_},this.SetWaveNBeat=function(_){t._wave_list=_.wave_list,t._beat_list=_.beat_list},this.GetWaveNBeat=function(){return{wave_list:t._wave_list,beat_list:t._beat_list}},this.AddWave=function(_){t._wave_list.push(_),t.SortWaveList()},this.AddBall=function(_){t._beat_list.push(_),t.SortBeatList(),t.CreateNotes(_)},this.SortBeatList=function(){t._beat_list.sort((function(_,e){return _.t-e.t}))},this.SortWaveList=function(){t._wave_list.sort((function(_,e){return _-e}))},this.UpdateGameObject=function(_){for(var e=t._game_objs.length-1;e>=0;e--){var i=t._game_objs[e];_.t==i._offset_ms&&t._game_objs.splice(e,1)}t.CreateNotes(_)},this.AddOrRemoveBall=function(_,e){var i=t._beat_list[_],a=0;switch(i.m&LEFT_BIT&&a++,i.m&UP_BIT&&a++,i.m&RIGHT_BIT&&a++,i.m&DOWN_BIT&&a++,e){case 1:i.m&LEFT_BIT?i.m^=LEFT_BIT:a<2&&(i.m|=LEFT_BIT);break;case 2:i.m&DOWN_BIT?i.m^=DOWN_BIT:a<2&&(i.m|=DOWN_BIT);break;case 3:i.m&UP_BIT?i.m^=UP_BIT:a<2&&(i.m|=UP_BIT);break;case 4:i.m&RIGHT_BIT?i.m^=RIGHT_BIT:a<2&&(i.m|=RIGHT_BIT)}t.UpdateGameObject(i)},this.UpdateGameObjectOffset=function(_,e,i){for(var a=0;a<t._game_objs.length;a++)t._game_objs[a]._offset_ms==_&&(t._game_objs[a].ChangeOffset(e),t._game_objs[a].Update(i))},this.CreateGameObjects=function(_){switch(_){case 1:t._speed=150;break;case 2:t._speed=160;break;case 3:t._speed=170;break;case 4:t._speed=180;break;case 5:t._speed=190;break;case 6:t._speed=200;break;case 7:t._speed=210}t._note_order=0,t._game_objs=[];for(var e=0;e<t._beat_list.length;e++)t.CreateNotes(t._beat_list[e])},this.CreateGameObjectsWithGivenTime=function(_){t._note_order=0,t._game_objs=[];for(var e=0;e<t._beat_list.length;e++)t.CreateNotes(t._beat_list[e],_)},this.CreateNotes=function(_,e){t._game_type==GAME_TYPE.DDR?t.CreateNotes_DDR(_,e):t._game_type==GAME_TYPE.Dash&&t.CreateNotes_Dash(_,e),t._note_order++},this.CreateNotes_DDR=function(_,e){if(_.m&LEFT_BIT){var i=null;t._dimension==DIMENSION._2D?i=new Ball(t._game_type,ARROW.LEFT,_.t,t._speed,t._base_line,t._move_direction,t._note_order).Init():t._dimension==DIMENSION._3D&&(i=new ThreeNote(ARROW.LEFT,_.t,t._speed,t._base_line).Init()),null!=e&&i.UpdatePos(e),t._game_objs.push(i)}if(_.m&UP_BIT){i=null;t._dimension==DIMENSION._2D?i=new Ball(t._game_type,ARROW.UP,_.t,t._speed,t._base_line,t._move_direction,t._note_order).Init():t._dimension==DIMENSION._3D&&(i=new ThreeNote(ARROW.UP,_.t,t._speed,t._base_line).Init()),null!=e&&i.UpdatePos(e),t._game_objs.push(i)}if(_.m&RIGHT_BIT){i=null;t._dimension==DIMENSION._2D?i=new Ball(t._game_type,ARROW.RIGHT,_.t,t._speed,t._base_line,t._move_direction,t._note_order).Init():t._dimension==DIMENSION._3D&&(i=new ThreeNote(ARROW.RIGHT,_.t,t._speed,t._base_line).Init()),null!=e&&i.UpdatePos(e),t._game_objs.push(i)}if(_.m&DOWN_BIT){i=null;t._dimension==DIMENSION._2D?i=new Ball(t._game_type,ARROW.DOWN,_.t,t._speed,t._base_line,t._move_direction,t._note_order).Init():t._dimension==DIMENSION._3D&&(i=new ThreeNote(ARROW.DOWN,_.t,t._speed,t._base_line).Init()),null!=e&&i.UpdatePos(e),t._game_objs.push(i)}},this.CreateNotes_Dash=function(_,e){var i=new Ball(t._game_type,ARROW.LEFT,_.t,t._speed,t._base_line,t._move_direction,t._note_order).Init();null!=e&&i.UpdatePos(e),t._game_objs.push(i)},this.DeleteWave=function(_){t._wave_list.splice(_,1)},this.DeleteBeat=function(_){var e=t._beat_list[_];t._beat_list.splice(_,1);for(var i=t._game_objs.length-1;i>=0;i--)e.t==t._game_objs[i]._offset_ms&&t._game_objs.splice(i,1)},this.PrependBeat=function(_){if(_>=t._beat_list.length||_<0)console.log(_+" out of range");else{var e=null;if(0==_){var i=t._beat_list[_+1].t-t._beat_list[_].t;t._game_type==GAME_TYPE.DDR?e={t:t._beat_list[_].t-i,m:LEFT_BIT}:t._game_type==GAME_TYPE.Dash&&(e={t:t._beat_list[_].t-i,n:1})}else{var a=(t._beat_list[_-1].t-t._beat_list[_].t)/2;a=Math.abs(a),a=Math.floor(a),console.log("half "+a),t._game_type==GAME_TYPE.DDR?e={t:t._beat_list[_].t-a,m:LEFT_BIT}:t._game_type==GAME_TYPE.Dash&&(e={t:t._beat_list[_].t-a,n:1}),console.log("beat_info.t "+e.t)}null!=e&&t.AddBall(e)}},this.PrependWave=function(_){_>=t._beat_list.length||_<0?console.log(_+" out of range"):t.AddWave(t._beat_list[_].t)},this.Shift=function(_){for(var e=0;e<t._beat_list.length;e++)t._beat_list[e].t+=_},this.DeleteFrom=function(_){t._beat_list.splice(_,t._beat_list.length)},this.ClearNoteList=function(){t._wave_list=[],t._beat_list=[]}}function GameControl(_,e){var t=this;this._width=_,this._height=e,this._base_line=100,this._timelapse=0,this._timelapse_youtube=0,this._game_started=!1,this._is_playing=!1,this._duration_sec=0,this._score=0,this._game_data=null,this._video_id="",this._cb_on_youtube_stopped=null,this._cb_on_game_finished=null,this._cb_on_youtube_video_ready_to_play=null,this._late_play=!1,this._combo=0,this._gameobj_begin_idx=0,this._finish_notified=!1,this._id_debug_ele=null,this._vibration_on_off=!1,this._base_offset_ms=0,this._game_level=1,this._is_complete=!1,this._is_excercise_mode=!1,this._total_hit_count=0,this._game_type=null,this._cur_wave_idx=0,this.Init=function(){return console.log("GameControl Init"),t._id_debug_ele=$("#id_debug"),_yt_player.SetEventListener(t.YT_OnYoutubeReady,t.YT_OnFlowEvent,t.YT_OnPlayerReady,t.YT_OnPlayerStateChange),t._game_data=new GameData(DIMENSION._2D,MOVE_DIRECTION.UPWARD),t.InitKeyHandle(),t.Update(),this},this.SetGameType=function(_){console.log("Game Type "+_),t._game_type=_,t._game_data.SetGameType(_)},this.SetVideoID=function(_){t._video_id=_},this.YT_OnYoutubeReady=function(){console.log("YT_OnYoutubeReady"),console.log("self._video_id "+t._video_id),""!=t._video_id&&_yt_player.LoadVideo(t._video_id)},this.YT_OnPlayerReady=function(_,e){t._duration_sec=e,console.log("YT_OnPlayerReady "+e),null!=t._cb_on_youtube_video_ready_to_play&&saelf._cb_on_youtube_video_ready_to_play(),_yt_player.SetPlaybackQuality(),1==t._late_play&&(t._late_play=!1,_yt_player.Play())},this.YT_OnPlayerStateChange=function(_){console.log("is_play "+_),_?(t._timelapse=0,t._timelapse_youtube=0,t._is_playing=!0,t._is_complete=!1,t._total_hit_count=0):(t._cb_on_youtube_stopped&&(console.log("_cb_on_youtube_stopped "),t._cb_on_youtube_stopped()),t._is_playing=!1)},this.YT_OnFlowEvent=function(_){_=parseInt(1e3*_),t._timelapse_youtube=_},this._touch_count=0,this._prev_left_touch_ts=0,this._prev_down_touch_ts=0,this._prev_up_touch_ts=0,this._prev_right_touch_ts=0,this.InitKeyHandle=function(){$("#ddr_player_layer1").on("touchmove",(function(_){_.preventDefault()})),$("#ddr_player_layer1").on("touchstart",(function(_){if(0!=t._is_playing){for(var e=window.innerWidth/4,i=[],a=0;a<_.originalEvent.touches.length;a++)for(var s=1;s<=4;s++)if(_.originalEvent.touches[a].pageX<e*s){switch(s){case 1:Date.now()-t._prev_left_touch_ts>100&&i.push(ARROW.LEFT),t._prev_left_touch_ts=Date.now();break;case 2:Date.now()-t._prev_down_touch_ts>100&&i.push(ARROW.DOWN),t._prev_down_touch_ts=Date.now();break;case 3:Date.now()-t._prev_up_touch_ts>100&&i.push(ARROW.UP),t._prev_up_touch_ts=Date.now();break;case 4:Date.now()-t._prev_right_touch_ts>100&&i.push(ARROW.RIGHT),t._prev_right_touch_ts=Date.now()}break}t._touch_count+=i.length,i.length>0&&t.Hit(i,t._timelapse)}})),document.addEventListener("keydown",(function(_){switch(_.keyCode){case ARROW.LEFT:case ARROW.UP:case ARROW.RIGHT:case ARROW.DOWN:_.preventDefault();var e=[_.keyCode];t.Hit(e,t._timelapse)}}))},this._hit_queue=[],this.Hit=async function(_,e){if(0!=t._is_playing)return e+=t._base_offset_ms,new Promise((function(i,a){for(var s=[],o=0;o<_.length;o++)for(var n=0;n<t._game_data._game_objs.length;n++){var l=t._game_data._game_objs[n];if(!l._is_hit&&!l._passed&&l._arrow_or_num==_[o]){s[o]=l;break}}var r=!1;if(2==_.length&&2==s.length&&s[0]._offset_ms==s[1]._offset_ms&&(r=!0),r){var h=s[0].HitNote(_[0],e);for(o=0;o<_.length;o++){if(t._score+=h.score,"Perfect"==h.text){if(t._combo++,t._combo>1){var c=10*(t._combo-1);t._score+=c}}else t._combo=0;t._hit_queue.push({arrow:d,hit_result:h,combo:t._combo}),1==h.hit&&(t._total_hit_count+=2)}}else for(o=0;o<_.length;o++){var d=_[o],u=s[o];if(null==u||null==u){h={hit:!1,score:-10,text:"Miss"};t._score+=h.score,t._combo=0,t._hit_queue.push({arrow:d,hit_result:h,combo:0})}else{h=u.HitNote(d,e);if(t._score+=h.score,"Perfect"==h.text){if(t._combo++,t._combo>1){c=10*(t._combo-1);t._score+=c}}else t._combo=0;t._hit_queue.push({arrow:d,hit_result:h,combo:t._combo}),1==h.hit&&t._total_hit_count++}}}))},this.SetWaveNBeat=function(_){t._game_data.SetWaveNBeat(_)},this.PrepareGame=function(){t._game_data.CreateGameObjects(t._game_level)},this.PlayGame=function(){console.log("play game "),1!=t._game_started&&(t._game_started=!0,_renderer._base_line=t._base_line,_renderer._render_mode=RENDER_MODE.PLAY,console.log("_renderer._render_mode  "+_renderer._render_mode),t._game_data._base_line=t._base_line,t._timelapse=0,t._timelapse_youtube=0,t._score=0,t._combo=0,t._gameobj_begin_idx=0,t._finish_notified=!1,_renderer._hit_combo=!1,_renderer.UpdateScore(t._score),_yt_player.SetEventListener(t.YT_OnYoutubeReady,t.YT_OnFlowEvent,t.YT_OnPlayerReady,t.YT_OnPlayerStateChange),0==_yt_player._is_player_ready?(_yt_player.LoadVideo(t._video_id),t._late_play=!0):_yt_player.Play())},this.PauseGame=function(){_yt_player.Pause()},this.StopGame=function(){console.log("StopGame "),_yt_player.Stop(),t._game_started=!1,t._is_playing=!1,t._finish_notified=!0},this._delta=0,this._tick=0,this._failed_gameobj_list=[],this.Update=function(){var _=Date.now();if(t._delta=_-t._tick,t._tick=_,t._is_playing){if(t._timelapse+=t._delta,t._timelapse_youtube+=t._delta,t._timelapse>t._timelapse_youtube){var e=t._timelapse-t._timelapse_youtube;t._timelapse-=e/20}else if(t._timelapse<t._timelapse_youtube){e=t._timelapse_youtube-t._timelapse;t._timelapse+=e/20}for(var i=t._gameobj_begin_idx;i<t._game_data._game_objs.length;i++){var a=t._game_data._game_objs[i];if(a._passed&&(t._gameobj_begin_idx=i+1,0==t._is_excercise_mode&&0==a._is_hit)){a._is_fail_cause=!0,a._passed=!1,t._finish_notified=!0,t._failed_gameobj_list=[],t._failed_gameobj_list=t._game_data._game_objs,t._cb_on_game_finished&&t._cb_on_game_finished(t._is_complete);break}if(0==a.Update(t._timelapse+t._base_offset_ms))break}if(t._hit_queue.length>0){var s=t._hit_queue[0];_renderer.Hit(s.arrow,s.hit_result,s.combo),console.log("hit.hit_result.hit "+s.hit_result.hit),0==t._is_excercise_mode&&0==s.hit_result.hit&&(t._finish_notified=!0,t._failed_gameobj_list=[],t._failed_gameobj_list=t._game_data._game_objs,t._cb_on_game_finished&&t._cb_on_game_finished(t._is_complete),console.log("FAILED GAME ")),1==t._hit_queue.length&&t._vibration_on_off&&t.VibrateAsync(s.hit_result.score,s.combo),t._hit_queue.splice(0,1)}var o=t._total_hit_count/t._game_data._game_objs.length;_renderer.UpdateProgress(o),_renderer.UpdateScore(t._score),_renderer.Update(t._game_data._game_objs,t._gameobj_begin_idx),t._game_data._game_objs.length==t._total_hit_count&&0==t._finish_notified&&(t._finish_notified=!0,t._is_complete=!0,t._cb_on_game_finished&&t._cb_on_game_finished(t._is_complete)),t.UpdateWave()}t._finish_notified&&(_renderer.UpdateScore(t._score),0==t._is_complete&&_renderer.Update(t._failed_gameobj_list,0),_renderer.DisplayResult(t._is_complete)),requestAnimationFrame(t.Update)},this._color_table=["#3d5a80","#98c1d9","#e0fbfc","#ee6c4d","#84a59d","#00b4d8","#f1c453","#e6beae"],this.UpdateWave=function(){if(!(t._cur_wave_idx>=t._game_data._wave_list.length)){var _=parseInt(Math.random()*t._color_table.length);t._timelapse>=t._game_data._wave_list[t._cur_wave_idx]&&($("#ddr_player_bg_layer").css("background-color",t._color_table[_]),t._cur_wave_idx++)}},this.VibrateAsync=function(_,e){return new Promise((function(){var t=_;switch(_){case 6:t=20;break;case 7:t=30;break;case 8:t=50;break;case 9:t=80;break;case 10:t=100}e>1&&(t+=10*e)>200&&(t=200),window.navigator.vibrate(t)}))}}function Ball(_,e,t,i,a,s,o){var n=this;this._game_type=_,this._arrow_or_num=e,this._img=null,this._x=0,this._y=-990,this._w=50,this._h=50,this._speed=i,this._offset_ms=t,this._offset_px_init=0,this._base_line_px=a,this._passed=!1,this._hit_y=0,this._x_base=0,this._is_hit=!1,this._move_direction=s,this._is_fail_cause=!1,this._order=o,this.Init=function(){return n._game_type==GAME_TYPE.DDR?n._arrow_or_num==ARROW.LEFT?(n._img=_atlas._img_l,n._x_base=50):n._arrow_or_num==ARROW.DOWN?(n._img=_atlas._img_d,n._x_base=150):n._arrow_or_num==ARROW.UP?(n._img=_atlas._img_u,n._x_base=250):n._arrow_or_num==ARROW.RIGHT&&(n._img=_atlas._img_r,n._x_base=350):n._game_type==GAME_TYPE.Dash&&(n._img=_atlas._img_l,n._x_base=50),n._x=n._x_base-n._w/2,n.CalcOffsetPixel(),this},this.CalcOffsetPixel=function(){n._offset_px_init=n._offset_ms/1e3*n._speed,n._offset_px_init=n._base_line_px+n._offset_px_init,n._offset_px_init=n._offset_px_init-n._h/2},this.ChangeOffset=function(_){n._offset_ms=_,n.CalcOffsetPixel()},this.Update=function(_){if(!n._passed)return!(Math.abs(_-n._offset_ms)>5e3)&&(n.UpdatePos(_),n._move_direction==MOVE_DIRECTION.UPWARD?n._hit_y<40&&(n._passed=!0):(n._move_direction,MOVE_DIRECTION.DOWNWARD),!0)},this.UpdatePos=function(_){var e=_/1e3*n._speed;n._move_direction==MOVE_DIRECTION.DOWNWARD?n._y=n._offset_px_init+e:n._y=n._offset_px_init-e,n._hit_y=n._y+n._h/2},this.Destroy=function(){},this.HitNote=function(_,e){var t={hit:!1,score:0,text:""};return n._arrow_or_num!=_?t:t=n.CheckHitByTime(e)},this.CheckHitByTime=function(_){var e={hit:!1,score:0,text:""},t=Math.abs(_-n._offset_ms);return 0<=t&&t<=300&&(n._is_hit=!0),0<=t&&t<100?(e.score=10,e.text="Perfect",e.hit=!0):100<=t&&t<150?(e.score=9,e.text="Excellent",e.hit=!0):150<=t&&t<200?(e.score=8,e.text="Very Good",e.hit=!0):200<=t&&t<250?(e.score=7,e.text="Good",e.hit=!0):250<=t&&t<=300?(e.score=6,e.text="Not Bad",e.hit=!0):300<t&&(e.score=-10,e.text="Miss",e.hit=!1),e},this.CheckHitByPixel=function(){var _={hit:!1,score:0,text:""},e=Math.abs(n._base_line_px-n._hit_y);return e<60?(_.hit=!0,n._w=2*n._w,n._h=2*n._h,n._x=n._x_base-n._w/2,n._arrow_or_num==ARROW.LEFT?n._img=_atlas._img_l_hit:n._arrow_or_num==ARROW.DOWN?n._img=_atlas._img_d_hit:n._arrow_or_num==ARROW.UP?n._img=_atlas._img_u_hit:n._arrow_or_num==ARROW.RIGHT&&(n._img=_atlas._img_r_hit),0<=e&&e<15?(_.score=10,_.text="Perfect"):15<=e&&e<20?(_.score=9,_.text="Excellent"):20<=e&e<25?(_.score=8,_.text="Very Good"):25<=e&e<30?(_.score=7,_.text="Good"):30<=e&e<=60&&(_.score=6,_.text="Not Bad"),n._is_hit=!0):(_.score=-10,_.text="Miss"),_}}function PlayGameControl(){var _=this;this._game_id=null,this._video_id=null,this._sound_key_list=[DEFAULT_SOUND_KEY,DEFAULT_SOUND_KEY,DEFAULT_SOUND_KEY,DEFAULT_SOUND_KEY],this._i_like=!1,this._my_score=-1,this._my_rank=-1,this._ddr_player_height=0,this._is_fullscreen=!1,this._is_mobile_device=!1,this._is_embedded=!1,this._level_allowed_to_play=!0,this.Init=function(){new MobileDetect(window.navigator.userAgent).mobile()?_._is_mobile_device=!0:_._is_mobile_device=!1,console.log("self._is_mobile_device "+_._is_mobile_device),$("#id_txt_debug").html("md "+_._is_mobile_device),_auth_control._cb_on_login=_.OnLogin,_auth_control._cb_on_logout=_.OnLogOut,_auth_control._cb_on_login_fail=_.OnLoginFail,_.InitLayout(),_.InitComponentHandle(),_.InitGameModules(),_._game_id=GetURLParam("id"),_._is_embedded=null!=GetURLParam("e"),null!=_._game_id&&(_.DisplayGameData(window._game_data),_.GetLike(),_.GetRanking()),window.addEventListener("resize",(function(){console.log("resize"),_.InitLayout()}))},this.InitLayout=function(){if(_._is_mobile_device){_._ddr_player_height=window.innerHeight-120,$("#ddr_player").css("height",_._ddr_player_height+"px"),$("#rank_layer").css("height",_._ddr_player_height+"px"),$("#player").css("height","120px"),_.ChangeLayout(LAYOUT.INFO)}else{var e=window.innerWidth;_._ddr_player_height=700;var t=(e-400)/2,i=400+t;$("#player").css("width",t),$("#player").css("left",0),$("#player").css("top",450),$("#ddr_player").css("left",t+"px"),$("#ddr_player").css("width",i+"px"),$("#ddr_player_bg_layer").css("left",t+"px"),$("#ddr_player_bg_layer").css("width","400px"),$("#ddr_player_bg_layer").css("height",_._ddr_player_height+"px"),$("#ddr_player_layer1").css("left",t+"px"),$("#ddr_player_layer1").css("width","400px"),$("#ddr_player_layer1").css("height",_._ddr_player_height+"px"),$("#info_layer").css("left","0px"),$("#info_layer").css("width",t+"px"),$("#info_layer").css("height","450px"),$("#rank_layer").css("left",t+400),$("#rank_layer").css("width",t),$("#rank_layer").css("height",window.innerHeight),_.ChangeLayout(LAYOUT.INFO)}},this.InitComponentHandle=function(){$("#id_btn_play").on("click",_.PlayGame),$("#id_btn_like").on("click",_.Like),$("#id_btn_back").on("click",(function(){window.history.back()})),$("#id_btn_home").on("click",(function(){document.location.href="https://beatmaster.me"})),$("#id_btn_rank").on("click",_.OnRankBtnClick),$("#id_btn_rank_hide").on("click",_.OnRankHideClick),$("#id_btn_stop_small").on("click",_.OnStopBtnClick),$("#id_btn_fullscreen").on("click",_.OnFullScreenBtnClick),$("#id_img_vibration").on("click",_.OnVibrationClick),$("#id_btn_stop").on("click",_.OnStopBtnClick),$("#id_btn_retry").on("click",_.RetryGame)},this.RetryGame=function(){$("#id_retry_area").css("display","none"),window._game_control.PrepareGame(),window._game_control.PlayGame()},this.OnVibrationClick=function(){_game_control._vibration_on_off=!_game_control._vibration_on_off,_game_control._vibration_on_off?($("#id_txt_vibration").html("ON"),$("#id_img_vibration").attr("src","img/vibration_on.png")):($("#id_txt_vibration").html("OFF"),$("#id_img_vibration").attr("src","img/vibration_off.png"))},this.OnFullScreenBtnClick=function(){var e=document.getElementById("lo_play");1==_._is_fullscreen?(_._is_fullscreen=!1,$("#id_icon_fullscreen").removeClass("fa-compress"),$("#id_icon_fullscreen").removeClass("fa-expand"),$("#id_icon_fullscreen").addClass("fa-compress"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()):(_._is_fullscreen=!0,$("#id_icon_fullscreen").removeClass("fa-compress"),$("#id_icon_fullscreen").removeClass("fa-expand"),$("#id_icon_fullscreen").addClass("fa-compress"),e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()),setTimeout(_.InitLayout,300)},this.OnRankBtnClick=function(){_.RankingLayerShowHide(!0)},this.OnRankHideClick=function(){_.RankingLayerShowHide(!1)},this.ShowHidePlayStopButton=function(e,t){e?1==_._level_allowed_to_play&&$("#id_btn_play").css("display",""):$("#id_btn_play").css("display","none"),t?$("#id_btn_stop").css("display",""):$("#id_btn_stop").css("display","none")},this.OnStopBtnClick=function(){console.log("OnStopBtnClick "),window._game_control.StopGame(),_.ShowHidePlayStopButton(!0,!1),_.ChangeLayout(LAYOUT.INFO),window._game_control.PrepareGame()},this.ChangeLayout=function(_){switch(_){case LAYOUT.INFO:$("#info_layer").css("visibility","visible"),$("#play_layer").css("visibility","hidden");break;case LAYOUT.PLAY:$("#info_layer").css("visibility","hidden"),$("#play_layer").css("visibility","visible")}},this.RankingLayerShowHide=function(e){e?($("#rank_layer").css("visibility","visible"),_.GetRanking()):$("#rank_layer").css("visibility","hidden")},this.PlayGame=function(){_._is_mobile_device&&_.ChangeLayout(LAYOUT.PLAY),_.ShowHidePlayStopButton(!1,!0),$("#id_retry_area").css("display","none"),_.UpdatePlayCount(),window._game_control.PlayGame()},this.UpdatePlayCount=function(){var e={game_id:_._game_id};$.ajax({url:"/beat_api/update_play_count",type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.ok?(console.log("updated "),_._play_count++,$("#id_text_play_count").html(_._play_count)):alert(e.err)}})},this.OnYoutubeStopped=function(){console.log("OnYoutubeStopped "),_game_control._is_playing},this.ShowRetryButton=function(){$("#id_retry_area").css("display","")},this.OnGameFinished=function(e){console.log("OnGameFinished "+e),_game_control._is_playing&&(1==e?null==_auth_control._user_info||_._my_score<_game_control._score&&_.SaveScore():(setTimeout(_.ShowRetryButton,500),window._game_control.StopGame()))},this.InitGameModules=function(){var e=400,t=700;_._is_mobile_device&&(e=window.innerWidth,t=_._ddr_player_height),window._yt_player=(new YoutubePlayer).Init(),window._game_control=new GameControl(400,700).Init(),window._renderer=new Renderer(400,700,e,t).Init()},this.DisplayGameData=function(e){_._video_id=e.video_id,_._sound_key_list=JSON.parse(e.sound_key_list),_game_control.SetGameType(e.game_type),_game_control._video_id=_._video_id,_._is_mobile_device&&(_game_control._base_offset_ms=window._game_data.base_offset_ms),_game_control._cb_on_youtube_stopped=_.OnYoutubeStopped,_game_control._cb_on_game_finished=_.OnGameFinished,_game_control._cb_on_youtube_video_ready_to_play=_.OnYoutubeVideoReadyToPlay();var t=JSON.parse(e.wave_n_beat);_game_control._game_level=e.level,_game_control.SetWaveNBeat(t),_game_control.PrepareGame(),$("#id_text_level").html(e.level)},this.OnYoutubeVideoReadyToPlay=function(){console.log("OnYoutubeVideoReadyToPlay "),$("#id_loading").css("display","none"),_.ShowHidePlayStopButton(!0,!1)},this.LoadInitDrums=function(){_drum_player.LoadDrum(0,_._sound_key_list[0]),_drum_player.LoadDrum(1,_._sound_key_list[1]),_drum_player.LoadDrum(2,_._sound_key_list[2]),_drum_player.LoadDrum(3,_._sound_key_list[3])},this.GetLike=function(){var e={game_id:_._game_id};$.ajax({url:"/beat_api/get_like",type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.ok?_.UpdateLikeButton(e.like_data):alert(e.err)}})},this.Like=function(){if(null!=_auth_control._user_info){var e={game_id:_._game_id,like:1!=_._i_like};$.ajax({url:"/beat_api/like",type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.ok?(console.log("res.like_data "+e.like_data),_.UpdateLikeButton(e.like_data)):alert(e.err)}})}else alert("login")},this.UpdateLikeButton=function(e){console.log("like_data.total "+e.total),console.log("like_data.i_like "+e.i_like),$("#id_text_like_count").html(e.total),$("#id_btn_like").removeClass("btn-secondary"),$("#id_btn_like").removeClass("btn-danger"),0==e.i_like?(_._i_like=!1,$("#id_btn_like").addClass("btn-secondary")):(_._i_like=!0,$("#id_btn_like").addClass("btn-danger"))},this.GetMyScoreAndRank=function(e){var t={game_id:_._game_id};$.ajax({url:"/beat_api/get_my_score_rank",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(t.ok){if(0==e&&(console.log("self._my_score "+_._my_score),console.log("res.data.score "+t.data.score),_._my_score<t.data.score)){console.log("new high ");if(-1!=_._my_rank){var i=_._my_rank-t.data.my_rank;i>0?"+":i<0&&"-"}}_._my_score=t.data.score,_._my_rank=t.data.rank,$("#id_text_my_score").html(t.data.score),$("#id_text_my_rank").html(t.data.my_rank)}else $("#id_text_my_score").html("-"),$("#id_text_my_rank").html("-")}})},this.OnLogin=function(){_.GetMyScoreAndRank(!0),console.log("level "+_auth_control._user_info.level),_._level_allowed_to_play=!0,_.ShowHidePlayStopButton(!0,!1),$("#id_txt_check_level").html("")},this.OnLogOut=function(){_.OnLoginFail()},this.OnLoginFail=function(){console.log("_game_data.level "+_game_data.level)},this.GetRanking=function(){var e={game_id:_._game_id};console.log("self._game_id "+_._game_id),$.ajax({url:"/beat_api/get_ranking",type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.ok?_.DisplayRanking(e.ranking):alert(e.err)}})},this.DisplayRanking=function(_){console.log("ranking "+_.length);var e=$("#id_table_ranking");e.empty();var t=0,i="";_.forEach((function(a){i+="<tr>",i+="<td>"+new Number(t+1)+"</td>",i+="<td>",i+='<image src="'+a.image_url+'" style="width:20px; height:20px"></image> &nbsp',i+=a.name,i+="</td>",i+="<td>"+a.score+"</td>",i+="</tr>",t++,console.log("cnt "+t),t==_.length&&e.append($(i))}))},this.SaveScore=function(){if(_._is_embedded)console.log("is embedded not save score. ");else if(null!=_auth_control._user_info){var e={game_id:_._game_id,score:_game_control._score};$.ajax({url:"/beat_api/save_score",type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){e.ok?(console.log("saved "),_.GetRanking(),_.GetMyScoreAndRank(!1)):alert(e.err)}})}}}$("document").ready((function(){})),$("document").ready((function(){window._drum_player=(new DrumPlayer).Init(),window._atlas=(new Atlas).Init(),window._timer=(new Timer).Init(),window._play_game_control=(new PlayGameControl).Init()}));